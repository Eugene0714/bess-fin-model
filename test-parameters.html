<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¾¹ç•Œè®¾å®šå‚æ•°ä¼ é€’æµ‹è¯•</title>
    <style>
        :root {
            --primary: #2563eb;
            --success: #22c55e;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg: #f8fafc;
            --card-bg: #fff;
            --border: #e2e8f0;
            --text: #1e293b;
            --text-secondary: #64748b;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .description {
            background: #dbeafe;
            border-left: 4px solid var(--primary);
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
        }
        
        .stats-bar {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .stat-card {
            background: var(--card-bg);
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            text-align: center;
            min-width: 150px;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
        }
        
        .stat-number.total { color: var(--primary); }
        .stat-number.pass { color: var(--success); }
        .stat-number.fail { color: var(--danger); }
        .stat-number.rate { color: var(--warning); }
        
        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .progress-container {
            background: #e2e8f0;
            border-radius: 20px;
            height: 30px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--success), #4ade80);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: bold;
            transition: width 0.5s ease;
        }
        
        .test-controls {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: #fff;
        }
        
        .btn-primary:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: var(--success);
            color: #fff;
        }
        
        .test-results {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        
        .test-category {
            border-bottom: 1px solid var(--border);
        }
        
        .test-category:last-child {
            border-bottom: none;
        }
        
        .category-header {
            background: #f1f5f9;
            padding: 15px 20px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .category-header:hover {
            background: #e2e8f0;
        }
        
        .category-stats {
            display: flex;
            gap: 15px;
            font-size: 13px;
        }
        
        .category-stats .pass { color: var(--success); }
        .category-stats .fail { color: var(--danger); }
        
        .test-items {
            padding: 10px 20px;
        }
        
        .test-item {
            display: flex;
            align-items: flex-start;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .test-item:last-child {
            border-bottom: none;
        }
        
        .test-icon {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .test-icon.pass {
            background: #dcfce7;
            color: var(--success);
        }
        
        .test-icon.fail {
            background: #fee2e2;
            color: var(--danger);
        }
        
        .test-content {
            flex: 1;
        }
        
        .test-name {
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .test-detail {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .test-detail.error {
            color: var(--danger);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .hidden-frame {
            position: absolute;
            width: 1px;
            height: 1px;
            opacity: 0;
            pointer-events: none;
        }
        
        .export-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: #fff;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
            z-index: 100;
        }
        
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(34, 197, 94, 0.5);
        }
        
        @media print {
            .export-btn, .test-controls {
                display: none !important;
            }
            body {
                background: #fff;
            }
        }
    </style>
</head>
<body>
    <button class="export-btn" onclick="exportPDF()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14,2 14,8 20,8"/>
            <line x1="12" y1="18" x2="12" y2="12"/>
            <polyline points="9,15 12,18 15,15"/>
        </svg>
        å¯¼å‡ºPDF
    </button>
    
    <div class="container">
        <h1>ğŸ” è¾¹ç•Œè®¾å®šå‚æ•°ä¼ é€’æµ‹è¯•æŠ¥å‘Š</h1>
        
        <div class="description">
            <strong>æµ‹è¯•ç›®æ ‡ï¼š</strong>éªŒè¯ç”¨æˆ·åœ¨è¾¹ç•Œè®¾å®šç•Œé¢ä¿®æ”¹å‚æ•°åï¼Œè¿™äº›å‚æ•°æ˜¯å¦è¢«æ­£ç¡®è¯»å–å¹¶ä¼ é€’åˆ°å„ä¸ªè´¢åŠ¡è®¡ç®—å‡½æ•°ä¸­ä½¿ç”¨ã€‚
            æœ¬æµ‹è¯•è¦†ç›–æ‰€æœ‰å…³é”®å‚æ•°çš„è¯»å–ã€ä¼ é€’å’Œä½¿ç”¨å…¨æµç¨‹éªŒè¯ã€‚
        </div>
        
        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-number total" id="totalCount">-</div>
                <div class="stat-label">æµ‹è¯•ç”¨ä¾‹æ€»æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number pass" id="passCount">-</div>
                <div class="stat-label">é€šè¿‡ç”¨ä¾‹æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number fail" id="failCount">-</div>
                <div class="stat-label">å¤±è´¥ç”¨ä¾‹æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number rate" id="passRate">-</div>
                <div class="stat-label">é€šè¿‡ç‡</div>
            </div>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar" id="progressBar" style="width: 0%">0%</div>
        </div>
        
        <div class="test-controls">
            <button class="btn btn-primary" onclick="runTests()">ğŸš€ è¿è¡Œæµ‹è¯•</button>
            <span id="testStatus" style="margin-left: 15px; color: var(--text-secondary);">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•</span>
        </div>
        
        <div class="test-results" id="testResults">
            <div class="loading" id="loadingIndicator" style="display: none;">
                <div class="spinner"></div>
                <div>æ­£åœ¨æ‰§è¡Œæµ‹è¯•...</div>
            </div>
        </div>
    </div>

    <!-- åŠ è½½è´¢åŠ¡æ¨¡å‹ -->
    <script src="financial-model.js"></script>
    
    <script>
        /**
         * æµ‹è¯•æ¡†æ¶
         */
        class ParameterTester {
            constructor() {
                this.results = [];
                this.categories = {};
            }
            
            /**
             * æ·»åŠ æµ‹è¯•ç»“æœ
             */
            addResult(category, name, passed, detail = '') {
                if (!this.categories[category]) {
                    this.categories[category] = [];
                }
                this.categories[category].push({ name, passed, detail });
                this.results.push({ category, name, passed, detail });
            }
            
            /**
             * è·å–ç»Ÿè®¡ä¿¡æ¯
             */
            getStats() {
                const total = this.results.length;
                const passed = this.results.filter(r => r.passed).length;
                const failed = total - passed;
                const rate = total > 0 ? (passed / total * 100).toFixed(1) : 0;
                return { total, passed, failed, rate };
            }
            
            /**
             * æ¸…ç©ºç»“æœ
             */
            clear() {
                this.results = [];
                this.categories = {};
            }
        }
        
        const tester = new ParameterTester();
        
        /**
         * åˆ›å»ºæ¨¡æ‹ŸDOMç¯å¢ƒç”¨äºæµ‹è¯•
         */
        function createMockDOM() {
            // åˆ›å»ºéšè—çš„å®¹å™¨æ¥æ¨¡æ‹Ÿinputå…ƒç´ 
            let container = document.getElementById('mockContainer');
            if (container) {
                container.remove();
            }
            container = document.createElement('div');
            container.id = 'mockContainer';
            container.style.display = 'none';
            
            // æ‰€æœ‰éœ€è¦æµ‹è¯•çš„å‚æ•°åŠå…¶é»˜è®¤å€¼
            const params = {
                // åŸºç¡€å‚æ•°
                power_mw: 100, capacity_mwh: 200, operation_years: 20, initial_capacity_pct: 100,
                // èèµ„å‚æ•°
                equity_ratio: 25, loan_years: 12, loan_rate: 4.5, grace_period: 1,
                // å»ºè®¾æœŸä¸é€šèƒ€å‚æ•°
                construction_period: 1, construction_fund_usage: 50, inflation_rate: 2.0,
                // æŠ˜æ—§å‚æ•°
                depreciation_years: 15, salvage_rate: 5, amortization_years: 20,
                // æ•ˆç‡å‚æ•°
                charge_efficiency: 95, discharge_efficiency: 95, degradation_rate: 2.5, annual_cycles: 365,
                // ç¨è´¹å‚æ•°
                corporate_tax_rate: 15, solidarity_tax_rate: 5.5, trade_tax_rate: 14, vat_rate: 19, other_tax_rate: 0,
                // Tollingå‚æ•°
                tolling_years: 10, tolling_ratio: 80, tolling_price: 95, tolling_escalation: 2.0,
                // è®¾å¤‡å‚æ•°
                battery_cabinet_capacity: 5.0, battery_cabinet_count: 40, battery_unit_price: 75,
                pcs_power: 5.5, pcs_count: 19, pcs_unit_price: 28,
                mv_transformer_capacity: 6300, mv_transformer_count: 19, mv_transformer_price: 35000,
                hv_transformer_capacity: 120, hv_transformer_count: 1, hv_transformer_price: 750000,
                // è¾…åŠ©è®¾å¤‡
                ems_cost: 200000, scada_cost: 120000, switchgear_price: 18000, switchgear_count: 25,
                collector_line_cost: 250000, thermal_cost: 20, fire_protection_cost: 12,
                // ç”µç½‘æ¥å…¥
                substation_cost: 800000, grid_line_cost: 500000, grid_study_cost: 80000, metering_cost: 100000,
                // åœŸåœ°åŸºå»º
                land_acquisition_cost: 50, concrete_cost: 25, fence_cost: 80000, road_cost: 120000, drainage_cost: 50000,
                // å®‰è£…æ–½å·¥
                installation_cost_pct: 6, construction_mgmt_pct: 2.5, commissioning_cost: 150000,
                // ä¿é™©
                car_insurance_pct: 0.30, ear_insurance_pct: 0.20, cargo_insurance_pct: 0.15, liability_insurance: 50000,
                // å¼€å‘è´¹ç”¨
                spv_acquisition_cost: 50000, permit_cost: 180000, environmental_cost: 60000, project_mgmt_pct: 2, legal_cost: 100000,
                engineering_pct: 2.5, contingency_pct: 5,
                // æ‹†é™¤å‡†å¤‡é‡‘ï¼ˆæŒ‰å¹´æ‘Šé”€ï¼‰
                decommissioning_total: 500000,
                // OPEX
                opex_technical: 6, opex_technical_esc: 2, opex_insurance: 0.4, opex_insurance_esc: 1.5,
                opex_grid: 12000, opex_grid_esc: 2, opex_land: 60000, opex_land_esc: 2,
                opex_commercial: 4000, opex_commercial_esc: 2, opex_other: 1500, opex_other_esc: 2,
                // ç°è´§ä»·æ ¼
                spot_base_price: 45000, spot_escalation: 1.5
            };
            
            // åˆ›å»ºselectå…ƒç´ 
            const selects = {
                repayment_method: 'equal_principal',
                depreciation_method: 'straight_line'
            };
            
            for (const [id, value] of Object.entries(params)) {
                const input = document.createElement('input');
                input.type = 'number';
                input.id = id;
                input.value = value;
                container.appendChild(input);
            }
            
            for (const [id, value] of Object.entries(selects)) {
                const select = document.createElement('select');
                select.id = id;
                const option = document.createElement('option');
                option.value = value;
                option.selected = true;
                select.appendChild(option);
                container.appendChild(select);
            }
            
            // åˆ›å»ºç°è´§ä»·æ ¼è¾“å…¥
            for (let i = 1; i <= 20; i++) {
                const input = document.createElement('input');
                input.type = 'number';
                input.id = `spot_price_${i}`;
                input.value = 45000 * Math.pow(1.015, i - 1);
                container.appendChild(input);
            }
            
            document.body.appendChild(container);
            return container;
        }
        
        /**
         * è®¾ç½®å‚æ•°å€¼
         */
        function setParam(id, value) {
            const el = document.getElementById(id);
            if (el) {
                el.value = value;
            }
        }
        
        /**
         * è·å–å‚æ•°å€¼
         */
        function getParam(id) {
            const el = document.getElementById(id);
            return el ? parseFloat(el.value) : null;
        }
        
        /**
         * æµ‹è¯•1ï¼šå‚æ•°è¯»å–æ­£ç¡®æ€§æµ‹è¯•
         */
        function testParameterReading() {
            const category = 'å‚æ•°è¯»å–æµ‹è¯•';
            
            // æµ‹è¯•åŸºç¡€å‚æ•°
            const tests = [
                { id: 'power_mw', testValue: 150, name: 'ç”µç«™è£…æœºåŠŸç‡' },
                { id: 'capacity_mwh', testValue: 300, name: 'ç”µç«™å‚¨èƒ½å®¹é‡' },
                { id: 'operation_years', testValue: 25, name: 'è¿è¥å¹´é™' },
                { id: 'equity_ratio', testValue: 30, name: 'èµ„æœ¬é‡‘æ¯”ä¾‹' },
                { id: 'loan_rate', testValue: 5.0, name: 'è´·æ¬¾åˆ©ç‡' },
                { id: 'degradation_rate', testValue: 3.0, name: 'å¹´è¡°å‡ç‡' },
                { id: 'tolling_price', testValue: 85, name: 'Tollingä»·æ ¼' },
                { id: 'battery_unit_price', testValue: 80, name: 'ç”µæ± å•ä»·' }
            ];
            
            for (const test of tests) {
                setParam(test.id, test.testValue);
                const params = getParameters();
                
                // æ£€æŸ¥å‚æ•°å€¼ï¼ˆæŸäº›å‚æ•°éœ€è¦é™¤ä»¥100ï¼‰
                let expected = test.testValue;
                const percentParams = ['equity_ratio', 'loan_rate', 'degradation_rate'];
                if (percentParams.includes(test.id)) {
                    expected = test.testValue / 100;
                }
                
                const actual = params[test.id];
                const passed = Math.abs(actual - expected) < 0.0001;
                tester.addResult(category, 
                    `${test.name}(${test.id})è¯»å–æ­£ç¡®`,
                    passed,
                    passed ? `è®¾ç½®${test.testValue}ï¼Œè¯»å–${actual}` : `æœŸæœ›${expected}ï¼Œå®é™…${actual}`
                );
            }
        }
        
        /**
         * æµ‹è¯•2ï¼šCAPEXè®¡ç®—å‚æ•°ä¼ é€’æµ‹è¯•
         */
        function testCapexParameterPassing() {
            const category = 'CAPEXå‚æ•°ä¼ é€’æµ‹è¯•';
            
            // é‡ç½®å‚æ•°
            createMockDOM();
            
            // æµ‹è¯•ç”µæ± ä»·æ ¼å˜åŒ–
            setParam('battery_unit_price', 75);
            let params = getParameters();
            let capex1 = calculateCapex(params);
            
            setParam('battery_unit_price', 100);
            params = getParameters();
            let capex2 = calculateCapex(params);
            
            let passed = capex2.battery > capex1.battery;
            tester.addResult(category, 
                'ç”µæ± å•ä»·å˜åŒ–å½±å“CAPEX',
                passed,
                passed ? `å•ä»·75â†’100ï¼Œç”µæ± æˆæœ¬${capex1.battery.toFixed(2)}â†’${capex2.battery.toFixed(2)}` : 'ç”µæ± æˆæœ¬æœªéšå•ä»·å˜åŒ–'
            );
            
            // æµ‹è¯•å®¹é‡å˜åŒ–
            createMockDOM();
            setParam('capacity_mwh', 200);
            params = getParameters();
            capex1 = calculateCapex(params);
            
            setParam('capacity_mwh', 300);
            params = getParameters();
            capex2 = calculateCapex(params);
            
            passed = capex2.battery > capex1.battery;
            tester.addResult(category, 
                'å‚¨èƒ½å®¹é‡å˜åŒ–å½±å“ç”µæ± æˆæœ¬',
                passed,
                passed ? `å®¹é‡200â†’300MWhï¼Œç”µæ± æˆæœ¬${capex1.battery.toFixed(2)}â†’${capex2.battery.toFixed(2)}` : 'ç”µæ± æˆæœ¬æœªéšå®¹é‡å˜åŒ–'
            );
            
            // æµ‹è¯•PCSä»·æ ¼
            createMockDOM();
            setParam('pcs_unit_price', 28);
            params = getParameters();
            capex1 = calculateCapex(params);
            
            setParam('pcs_unit_price', 35);
            params = getParameters();
            capex2 = calculateCapex(params);
            
            passed = capex2.pcs > capex1.pcs;
            tester.addResult(category, 
                'PCSå•ä»·å˜åŒ–å½±å“PCSæˆæœ¬',
                passed,
                passed ? `å•ä»·28â†’35ï¼ŒPCSæˆæœ¬${capex1.pcs.toFixed(2)}â†’${capex2.pcs.toFixed(2)}` : 'PCSæˆæœ¬æœªéšå•ä»·å˜åŒ–'
            );
            
            // æµ‹è¯•å®‰è£…è´¹ç‡
            createMockDOM();
            setParam('installation_cost_pct', 6);
            params = getParameters();
            capex1 = calculateCapex(params);
            
            setParam('installation_cost_pct', 10);
            params = getParameters();
            capex2 = calculateCapex(params);
            
            passed = capex2.installation > capex1.installation;
            tester.addResult(category, 
                'å®‰è£…è´¹ç‡å˜åŒ–å½±å“å®‰è£…æˆæœ¬',
                passed,
                passed ? `è´¹ç‡6%â†’10%ï¼Œå®‰è£…æˆæœ¬${capex1.installation.toFixed(2)}â†’${capex2.installation.toFixed(2)}` : 'å®‰è£…æˆæœ¬æœªéšè´¹ç‡å˜åŒ–'
            );
            
            // æµ‹è¯•contingencyè´¹ç‡
            createMockDOM();
            setParam('contingency_pct', 5);
            params = getParameters();
            capex1 = calculateCapex(params);
            
            setParam('contingency_pct', 8);
            params = getParameters();
            capex2 = calculateCapex(params);
            
            passed = capex2.contingency > capex1.contingency;
            tester.addResult(category, 
                'ä¸å¯é¢„è§è´¹ç‡å˜åŒ–å½±å“ä¸å¯é¢„è§è´¹',
                passed,
                passed ? `è´¹ç‡5%â†’8%ï¼Œä¸å¯é¢„è§è´¹${capex1.contingency.toFixed(2)}â†’${capex2.contingency.toFixed(2)}` : 'ä¸å¯é¢„è§è´¹æœªéšè´¹ç‡å˜åŒ–'
            );
        }
        
        /**
         * æµ‹è¯•3ï¼šOPEXè®¡ç®—å‚æ•°ä¼ é€’æµ‹è¯•
         */
        function testOpexParameterPassing() {
            const category = 'OPEXå‚æ•°ä¼ é€’æµ‹è¯•';
            
            createMockDOM();
            let params = getParameters();
            let capex = calculateCapex(params);
            
            // æµ‹è¯•æŠ€æœ¯è¿ç»´è´¹
            setParam('opex_technical', 6);
            params = getParameters();
            let opex1 = calculateOpex(params, capex);
            
            setParam('opex_technical', 10);
            params = getParameters();
            let opex2 = calculateOpex(params, capex);
            
            let passed = opex2[0].technical > opex1[0].technical;
            tester.addResult(category, 
                'æŠ€æœ¯è¿ç»´è´¹ç‡å˜åŒ–å½±å“OPEX',
                passed,
                passed ? `è´¹ç‡6â†’10ï¼ŒæŠ€æœ¯è¿ç»´è´¹${opex1[0].technical.toFixed(2)}â†’${opex2[0].technical.toFixed(2)}` : 'æŠ€æœ¯è¿ç»´è´¹æœªéšè´¹ç‡å˜åŒ–'
            );
            
            // æµ‹è¯•åœŸåœ°ç§Ÿé‡‘
            createMockDOM();
            params = getParameters();
            capex = calculateCapex(params);
            
            setParam('opex_land', 60000);
            params = getParameters();
            opex1 = calculateOpex(params, capex);
            
            setParam('opex_land', 100000);
            params = getParameters();
            opex2 = calculateOpex(params, capex);
            
            passed = opex2[0].land > opex1[0].land;
            tester.addResult(category, 
                'åœŸåœ°ç§Ÿé‡‘å˜åŒ–å½±å“OPEX',
                passed,
                passed ? `ç§Ÿé‡‘60kâ†’100kï¼ŒåœŸåœ°è´¹${opex1[0].land.toFixed(2)}â†’${opex2[0].land.toFixed(2)}` : 'åœŸåœ°è´¹æœªéšç§Ÿé‡‘å˜åŒ–'
            );
            
            // æµ‹è¯•OPEXå¹´å¢é•¿ç‡
            createMockDOM();
            setParam('opex_technical_esc', 2);
            params = getParameters();
            capex = calculateCapex(params);
            opex1 = calculateOpex(params, capex);
            const year1_tech = opex1[4].technical; // ç¬¬5å¹´
            
            createMockDOM();
            setParam('opex_technical_esc', 5);
            params = getParameters();
            opex2 = calculateOpex(params, capex);
            const year1_tech_high = opex2[4].technical;
            
            passed = year1_tech_high > year1_tech;
            tester.addResult(category, 
                'æŠ€æœ¯è´¹å¢é•¿ç‡å½±å“åç»­å¹´ä»½OPEX',
                passed,
                passed ? `å¢é•¿ç‡2%â†’5%ï¼Œç¬¬5å¹´æŠ€æœ¯è´¹${year1_tech.toFixed(2)}â†’${year1_tech_high.toFixed(2)}` : 'åç»­å¹´ä»½OPEXæœªéšå¢é•¿ç‡å˜åŒ–'
            );

            // æµ‹è¯•æ‹†é™¤å‡†å¤‡é‡‘æŒ‰å¹´æ‘Šé”€
            createMockDOM();
            setParam('decommissioning_total', 600000);
            params = getParameters();
            capex = calculateCapex(params);
            const opexWithDecom = calculateOpex(params, capex);
            const expectedDecom = 600000 / params.operation_years / 10000;
            passed = Math.abs(opexWithDecom[0].decommissioning - expectedDecom) < 0.01;
            tester.addResult(category,
                'æ‹†é™¤å‡†å¤‡é‡‘æŒ‰å¹´æ‘Šé”€è®¡å…¥OPEX',
                passed,
                passed ? `æ€»é¢60ä¸‡EURï¼Œå¹´è®¡æ${opexWithDecom[0].decommissioning.toFixed(2)}ä¸‡EUR` : `æœŸæœ›${expectedDecom.toFixed(2)}ä¸‡EURï¼Œå®é™…${opexWithDecom[0].decommissioning.toFixed(2)}ä¸‡EUR`
            );
        }
        
        /**
         * æµ‹è¯•4ï¼šæ”¶å…¥è®¡ç®—å‚æ•°ä¼ é€’æµ‹è¯•
         */
        function testRevenueParameterPassing() {
            const category = 'æ”¶å…¥å‚æ•°ä¼ é€’æµ‹è¯•';
            
            // æµ‹è¯•Tollingä»·æ ¼
            createMockDOM();
            setParam('tolling_price', 85);
            let params = getParameters();
            let revenue1 = calculateRevenue(params);
            
            setParam('tolling_price', 100);
            params = getParameters();
            let revenue2 = calculateRevenue(params);
            
            let passed = revenue2[0].tollingRevenue > revenue1[0].tollingRevenue;
            tester.addResult(category, 
                'Tollingä»·æ ¼å˜åŒ–å½±å“æ”¶å…¥',
                passed,
                passed ? `ä»·æ ¼85â†’100ï¼ŒTollingæ”¶å…¥${revenue1[0].tollingRevenue.toFixed(2)}â†’${revenue2[0].tollingRevenue.toFixed(2)}` : 'Tollingæ”¶å…¥æœªéšä»·æ ¼å˜åŒ–'
            );
            
            // æµ‹è¯•Tollingæ¯”ä¾‹
            createMockDOM();
            setParam('tolling_ratio', 80);
            params = getParameters();
            revenue1 = calculateRevenue(params);
            
            setParam('tolling_ratio', 60);
            params = getParameters();
            revenue2 = calculateRevenue(params);
            
            passed = revenue1[0].tollingRevenue > revenue2[0].tollingRevenue;
            tester.addResult(category, 
                'Tollingæ¯”ä¾‹å˜åŒ–å½±å“Tollingæ”¶å…¥',
                passed,
                passed ? `æ¯”ä¾‹80%â†’60%ï¼ŒTollingæ”¶å…¥${revenue1[0].tollingRevenue.toFixed(2)}â†’${revenue2[0].tollingRevenue.toFixed(2)}` : 'Tollingæ”¶å…¥æœªéšæ¯”ä¾‹å˜åŒ–'
            );
            
            // æµ‹è¯•è¡°å‡ç‡
            createMockDOM();
            setParam('degradation_rate', 2);
            params = getParameters();
            revenue1 = calculateRevenue(params);
            const year10_rev1 = revenue1[9].totalRevenue;
            
            createMockDOM();
            setParam('degradation_rate', 5);
            params = getParameters();
            revenue2 = calculateRevenue(params);
            const year10_rev2 = revenue2[9].totalRevenue;
            
            passed = year10_rev1 > year10_rev2;
            tester.addResult(category, 
                'è¡°å‡ç‡å˜åŒ–å½±å“åæœŸæ”¶å…¥',
                passed,
                passed ? `è¡°å‡ç‡2%â†’5%ï¼Œç¬¬10å¹´æ”¶å…¥${year10_rev1.toFixed(2)}â†’${year10_rev2.toFixed(2)}` : 'åæœŸæ”¶å…¥æœªéšè¡°å‡ç‡å˜åŒ–'
            );
            
            // æµ‹è¯•è£…æœºåŠŸç‡
            createMockDOM();
            setParam('power_mw', 100);
            params = getParameters();
            revenue1 = calculateRevenue(params);
            
            createMockDOM();
            setParam('power_mw', 150);
            params = getParameters();
            revenue2 = calculateRevenue(params);
            
            passed = revenue2[0].tollingRevenue > revenue1[0].tollingRevenue;
            tester.addResult(category, 
                'è£…æœºåŠŸç‡å˜åŒ–å½±å“Tollingæ”¶å…¥',
                passed,
                passed ? `åŠŸç‡100â†’150MWï¼ŒTollingæ”¶å…¥${revenue1[0].tollingRevenue.toFixed(2)}â†’${revenue2[0].tollingRevenue.toFixed(2)}` : 'Tollingæ”¶å…¥æœªéšåŠŸç‡å˜åŒ–'
            );
        }
        
        /**
         * æµ‹è¯•5ï¼šæŠ˜æ—§è®¡ç®—å‚æ•°ä¼ é€’æµ‹è¯•
         */
        function testDepreciationParameterPassing() {
            const category = 'æŠ˜æ—§å‚æ•°ä¼ é€’æµ‹è¯•';
            
            createMockDOM();
            let params = getParameters();
            let capex = calculateCapex(params);
            
            // æµ‹è¯•æŠ˜æ—§å¹´é™
            setParam('depreciation_years', 15);
            params = getParameters();
            let depreciation1 = calculateDepreciation(params, capex);
            
            setParam('depreciation_years', 10);
            params = getParameters();
            let depreciation2 = calculateDepreciation(params, capex);
            
            let passed = depreciation2[0].depreciation > depreciation1[0].depreciation;
            tester.addResult(category, 
                'æŠ˜æ—§å¹´é™å˜åŒ–å½±å“å¹´åº¦æŠ˜æ—§é¢',
                passed,
                passed ? `å¹´é™15â†’10å¹´ï¼Œå¹´æŠ˜æ—§${depreciation1[0].depreciation.toFixed(2)}â†’${depreciation2[0].depreciation.toFixed(2)}` : 'å¹´æŠ˜æ—§æœªéšå¹´é™å˜åŒ–'
            );
            
            // æµ‹è¯•æ®‹å€¼ç‡
            createMockDOM();
            setParam('salvage_rate', 5);
            params = getParameters();
            capex = calculateCapex(params);
            depreciation1 = calculateDepreciation(params, capex);
            
            setParam('salvage_rate', 10);
            params = getParameters();
            depreciation2 = calculateDepreciation(params, capex);
            
            passed = depreciation1[0].depreciation > depreciation2[0].depreciation;
            tester.addResult(category, 
                'æ®‹å€¼ç‡å˜åŒ–å½±å“æŠ˜æ—§é¢',
                passed,
                passed ? `æ®‹å€¼ç‡5%â†’10%ï¼Œå¹´æŠ˜æ—§${depreciation1[0].depreciation.toFixed(2)}â†’${depreciation2[0].depreciation.toFixed(2)}` : 'æŠ˜æ—§é¢æœªéšæ®‹å€¼ç‡å˜åŒ–'
            );
            
            // æµ‹è¯•æ‘Šé”€å¹´é™
            createMockDOM();
            setParam('amortization_years', 20);
            params = getParameters();
            capex = calculateCapex(params);
            depreciation1 = calculateDepreciation(params, capex);
            
            setParam('amortization_years', 10);
            params = getParameters();
            depreciation2 = calculateDepreciation(params, capex);
            
            passed = depreciation2[0].amortization > depreciation1[0].amortization;
            tester.addResult(category, 
                'æ‘Šé”€å¹´é™å˜åŒ–å½±å“å¹´åº¦æ‘Šé”€é¢',
                passed,
                passed ? `å¹´é™20â†’10å¹´ï¼Œå¹´æ‘Šé”€${depreciation1[0].amortization.toFixed(2)}â†’${depreciation2[0].amortization.toFixed(2)}` : 'å¹´æ‘Šé”€æœªéšå¹´é™å˜åŒ–'
            );
        }
        
        /**
         * æµ‹è¯•6ï¼šè´·æ¬¾è®¡ç®—å‚æ•°ä¼ é€’æµ‹è¯•
         */
        function testLoanParameterPassing() {
            const category = 'è´·æ¬¾å‚æ•°ä¼ é€’æµ‹è¯•';
            
            createMockDOM();
            let params = getParameters();
            let capex = calculateCapex(params);
            
            // æµ‹è¯•èµ„æœ¬é‡‘æ¯”ä¾‹
            setParam('equity_ratio', 25);
            params = getParameters();
            capex = calculateCapex(params);
            let loan1 = calculateLoan(params, capex);
            
            setParam('equity_ratio', 40);
            params = getParameters();
            capex = calculateCapex(params);
            let loan2 = calculateLoan(params, capex);
            
            let passed = loan1[0].beginBalance > loan2[0].beginBalance;
            tester.addResult(category, 
                'èµ„æœ¬é‡‘æ¯”ä¾‹å˜åŒ–å½±å“è´·æ¬¾æ€»é¢',
                passed,
                passed ? `èµ„æœ¬é‡‘25%â†’40%ï¼Œè´·æ¬¾${loan1[0].beginBalance.toFixed(2)}â†’${loan2[0].beginBalance.toFixed(2)}` : 'è´·æ¬¾æ€»é¢æœªéšèµ„æœ¬é‡‘æ¯”ä¾‹å˜åŒ–'
            );
            
            // æµ‹è¯•è´·æ¬¾åˆ©ç‡
            createMockDOM();
            setParam('loan_rate', 4.5);
            params = getParameters();
            capex = calculateCapex(params);
            loan1 = calculateLoan(params, capex);
            
            setParam('loan_rate', 6.0);
            params = getParameters();
            capex = calculateCapex(params);
            loan2 = calculateLoan(params, capex);
            
            passed = loan2[0].interest > loan1[0].interest;
            tester.addResult(category, 
                'è´·æ¬¾åˆ©ç‡å˜åŒ–å½±å“åˆ©æ¯æ”¯å‡º',
                passed,
                passed ? `åˆ©ç‡4.5%â†’6%ï¼Œå¹´åˆ©æ¯${loan1[0].interest.toFixed(2)}â†’${loan2[0].interest.toFixed(2)}` : 'åˆ©æ¯æ”¯å‡ºæœªéšåˆ©ç‡å˜åŒ–'
            );
            
            // æµ‹è¯•è´·æ¬¾å¹´é™
            createMockDOM();
            setParam('loan_years', 12);
            params = getParameters();
            capex = calculateCapex(params);
            loan1 = calculateLoan(params, capex);
            
            setParam('loan_years', 15);
            params = getParameters();
            capex = calculateCapex(params);
            loan2 = calculateLoan(params, capex);
            
            passed = loan1[1].principal > loan2[1].principal;
            tester.addResult(category, 
                'è´·æ¬¾å¹´é™å˜åŒ–å½±å“å¹´è¿˜æœ¬é¢',
                passed,
                passed ? `å¹´é™12â†’15å¹´ï¼Œå¹´è¿˜æœ¬${loan1[1].principal.toFixed(2)}â†’${loan2[1].principal.toFixed(2)}` : 'å¹´è¿˜æœ¬é¢æœªéšå¹´é™å˜åŒ–'
            );
            
            // æµ‹è¯•å®½é™æœŸ
            createMockDOM();
            setParam('grace_period', 0);
            params = getParameters();
            capex = calculateCapex(params);
            loan1 = calculateLoan(params, capex);
            
            setParam('grace_period', 2);
            params = getParameters();
            capex = calculateCapex(params);
            loan2 = calculateLoan(params, capex);
            
            passed = loan1[0].principal > 0 && loan2[0].principal === 0;
            tester.addResult(category, 
                'å®½é™æœŸå˜åŒ–å½±å“é¦–å¹´è¿˜æœ¬',
                passed,
                passed ? `å®½é™æœŸ0â†’2å¹´ï¼Œé¦–å¹´è¿˜æœ¬${loan1[0].principal.toFixed(2)}â†’${loan2[0].principal.toFixed(2)}` : 'é¦–å¹´è¿˜æœ¬æœªéšå®½é™æœŸå˜åŒ–'
            );
        }
        
        /**
         * æµ‹è¯•7ï¼šç¨ç‡å‚æ•°ä¼ é€’æµ‹è¯•
         */
        function testTaxParameterPassing() {
            const category = 'ç¨ç‡å‚æ•°ä¼ é€’æµ‹è¯•';
            
            createMockDOM();
            let params = getParameters();
            let capex = calculateCapex(params);
            let opex = calculateOpex(params, capex);
            let revenue = calculateRevenue(params);
            let depreciation = calculateDepreciation(params, capex);
            let loan = calculateLoan(params, capex);
            
            // æµ‹è¯•ä¼ä¸šæ‰€å¾—ç¨ç‡
            setParam('corporate_tax_rate', 15);
            params = getParameters();
            let income1 = calculateIncomeStatement(params, revenue, opex, depreciation, loan);
            
            setParam('corporate_tax_rate', 25);
            params = getParameters();
            let income2 = calculateIncomeStatement(params, revenue, opex, depreciation, loan);
            
            let passed = income2[0].tax > income1[0].tax || (income1[0].ebt < 0 && income2[0].ebt < 0);
            if (income1[0].ebt < 0) {
                passed = true; // å¦‚æœç¨å‰åˆ©æ¶¦ä¸ºè´Ÿï¼Œåˆ™æ— æ³•æ¯”è¾ƒç¨é¢
                tester.addResult(category, 
                    'ä¼ä¸šæ‰€å¾—ç¨ç‡å˜åŒ–å½±å“ç¨é¢',
                    passed,
                    'ç¨å‰åˆ©æ¶¦ä¸ºè´Ÿï¼Œæ— éœ€ç¼´ç¨ï¼Œè·³è¿‡æµ‹è¯•'
                );
            } else {
                tester.addResult(category, 
                    'ä¼ä¸šæ‰€å¾—ç¨ç‡å˜åŒ–å½±å“ç¨é¢',
                    passed,
                    passed ? `ç¨ç‡15%â†’25%ï¼Œç¨é¢${income1[0].tax.toFixed(2)}â†’${income2[0].tax.toFixed(2)}` : 'ç¨é¢æœªéšç¨ç‡å˜åŒ–'
                );
            }
            
            // æµ‹è¯•ç»¼åˆç¨ç‡è®¡ç®—
            createMockDOM();
            params = getParameters();
            const corpRate = params.corporate_tax_rate;
            const solidRate = params.solidarity_tax_rate;
            const tradeRate = params.trade_tax_rate;
            
            // å¾·å›½ç¨åˆ¶: ç»¼åˆç¨ç‡ = ä¼ä¸šæ‰€å¾—ç¨ + å›¢ç»“é™„åŠ ç¨ + è´¸æ˜“ç¨
            const effectiveRate = corpRate * (1 + solidRate) + tradeRate;
            passed = effectiveRate > corpRate;
            tester.addResult(category, 
                'ç»¼åˆç¨ç‡è®¡ç®—æ­£ç¡®',
                passed,
                `ä¼ä¸šç¨${(corpRate*100).toFixed(1)}% + å›¢ç»“é™„åŠ ç¨${(solidRate*100).toFixed(1)}% + è´¸æ˜“ç¨${(tradeRate*100).toFixed(1)}% = ${(effectiveRate*100).toFixed(2)}%`
            );
        }
        
        /**
         * æµ‹è¯•8ï¼šè´¢åŠ¡æŒ‡æ ‡å‚æ•°å½±å“æµ‹è¯•
         */
        function testIndicatorsParameterPassing() {
            const category = 'è´¢åŠ¡æŒ‡æ ‡å‚æ•°å½±å“æµ‹è¯•';
            
            // æµ‹è¯•Tollingä»·æ ¼å¯¹IRRçš„å½±å“
            createMockDOM();
            setParam('tolling_price', 85);
            let params = getParameters();
            let capex = calculateCapex(params);
            let opex = calculateOpex(params, capex);
            let revenue = calculateRevenue(params);
            let depreciation = calculateDepreciation(params, capex);
            let loan = calculateLoan(params, capex);
            let income = calculateIncomeStatement(params, revenue, opex, depreciation, loan);
            let cashFlow = calculateCashFlow(params, capex, income, depreciation, loan);
            let balance = calculateBalanceSheet(params, capex, income, depreciation, loan, cashFlow);
            let indicators1 = calculateIndicators(params, capex, revenue, income, cashFlow, balance, loan);
            
            createMockDOM();
            setParam('tolling_price', 110);
            params = getParameters();
            capex = calculateCapex(params);
            opex = calculateOpex(params, capex);
            revenue = calculateRevenue(params);
            depreciation = calculateDepreciation(params, capex);
            loan = calculateLoan(params, capex);
            income = calculateIncomeStatement(params, revenue, opex, depreciation, loan);
            cashFlow = calculateCashFlow(params, capex, income, depreciation, loan);
            balance = calculateBalanceSheet(params, capex, income, depreciation, loan, cashFlow);
            let indicators2 = calculateIndicators(params, capex, revenue, income, cashFlow, balance, loan);
            
            let passed = indicators2.projectIRR > indicators1.projectIRR;
            tester.addResult(category, 
                'Tollingä»·æ ¼ä¸Šæ¶¨æé«˜é¡¹ç›®IRR',
                passed,
                passed ? `ä»·æ ¼85â†’110ï¼ŒIRR ${(indicators1.projectIRR*100).toFixed(2)}%â†’${(indicators2.projectIRR*100).toFixed(2)}%` : 'IRRæœªéšä»·æ ¼ä¸Šæ¶¨'
            );
            
            // æµ‹è¯•ç”µæ± å•ä»·å¯¹IRRçš„å½±å“
            createMockDOM();
            setParam('battery_unit_price', 85);
            params = getParameters();
            capex = calculateCapex(params);
            opex = calculateOpex(params, capex);
            revenue = calculateRevenue(params);
            depreciation = calculateDepreciation(params, capex);
            loan = calculateLoan(params, capex);
            income = calculateIncomeStatement(params, revenue, opex, depreciation, loan);
            cashFlow = calculateCashFlow(params, capex, income, depreciation, loan);
            balance = calculateBalanceSheet(params, capex, income, depreciation, loan, cashFlow);
            indicators1 = calculateIndicators(params, capex, revenue, income, cashFlow, balance, loan);
            
            createMockDOM();
            setParam('battery_unit_price', 65);
            params = getParameters();
            capex = calculateCapex(params);
            opex = calculateOpex(params, capex);
            revenue = calculateRevenue(params);
            depreciation = calculateDepreciation(params, capex);
            loan = calculateLoan(params, capex);
            income = calculateIncomeStatement(params, revenue, opex, depreciation, loan);
            cashFlow = calculateCashFlow(params, capex, income, depreciation, loan);
            balance = calculateBalanceSheet(params, capex, income, depreciation, loan, cashFlow);
            indicators2 = calculateIndicators(params, capex, revenue, income, cashFlow, balance, loan);
            
            passed = indicators2.projectIRR > indicators1.projectIRR;
            tester.addResult(category, 
                'ç”µæ± å•ä»·ä¸‹é™æé«˜é¡¹ç›®IRR',
                passed,
                passed ? `å•ä»·85â†’65ï¼ŒIRR ${(indicators1.projectIRR*100).toFixed(2)}%â†’${(indicators2.projectIRR*100).toFixed(2)}%` : 'IRRæœªéšå•ä»·ä¸‹é™'
            );
            
            // æµ‹è¯•è´·æ¬¾åˆ©ç‡å¯¹æƒç›ŠIRRçš„å½±å“
            createMockDOM();
            setParam('loan_rate', 4.0);
            params = getParameters();
            capex = calculateCapex(params);
            opex = calculateOpex(params, capex);
            revenue = calculateRevenue(params);
            depreciation = calculateDepreciation(params, capex);
            loan = calculateLoan(params, capex);
            income = calculateIncomeStatement(params, revenue, opex, depreciation, loan);
            cashFlow = calculateCashFlow(params, capex, income, depreciation, loan);
            balance = calculateBalanceSheet(params, capex, income, depreciation, loan, cashFlow);
            indicators1 = calculateIndicators(params, capex, revenue, income, cashFlow, balance, loan);
            
            createMockDOM();
            setParam('loan_rate', 6.0);
            params = getParameters();
            capex = calculateCapex(params);
            opex = calculateOpex(params, capex);
            revenue = calculateRevenue(params);
            depreciation = calculateDepreciation(params, capex);
            loan = calculateLoan(params, capex);
            income = calculateIncomeStatement(params, revenue, opex, depreciation, loan);
            cashFlow = calculateCashFlow(params, capex, income, depreciation, loan);
            balance = calculateBalanceSheet(params, capex, income, depreciation, loan, cashFlow);
            indicators2 = calculateIndicators(params, capex, revenue, income, cashFlow, balance, loan);
            
            passed = indicators1.equityIRR > indicators2.equityIRR;
            tester.addResult(category, 
                'è´·æ¬¾åˆ©ç‡ä¸Šå‡é™ä½æƒç›ŠIRR',
                passed,
                passed ? `åˆ©ç‡4%â†’6%ï¼Œæƒç›ŠIRR ${(indicators1.equityIRR*100).toFixed(2)}%â†’${(indicators2.equityIRR*100).toFixed(2)}%` : 'æƒç›ŠIRRæœªéšåˆ©ç‡å˜åŒ–'
            );
        }
        
        /**
         * è¿è¡Œæ‰€æœ‰æµ‹è¯•
         */
        async function runTests() {
            tester.clear();
            document.getElementById('testStatus').textContent = 'æ­£åœ¨æ‰§è¡Œæµ‹è¯•...';
            document.getElementById('loadingIndicator').style.display = 'block';
            document.getElementById('testResults').innerHTML = '<div class="loading" id="loadingIndicator"><div class="spinner"></div><div>æ­£åœ¨æ‰§è¡Œæµ‹è¯•...</div></div>';
            
            // ç»™UIæ›´æ–°çš„æ—¶é—´
            await new Promise(resolve => setTimeout(resolve, 100));
            
            try {
                // åˆ›å»ºæ¨¡æ‹ŸDOM
                createMockDOM();
                
                // æ‰§è¡Œå„ç±»æµ‹è¯•
                testParameterReading();
                testCapexParameterPassing();
                testOpexParameterPassing();
                testRevenueParameterPassing();
                testDepreciationParameterPassing();
                testLoanParameterPassing();
                testTaxParameterPassing();
                testIndicatorsParameterPassing();
                
                // æ›´æ–°ç»Ÿè®¡
                updateStats();
                
                // æ¸²æŸ“ç»“æœ
                renderResults();
                
                document.getElementById('testStatus').textContent = 'æµ‹è¯•å®Œæˆï¼';
            } catch (error) {
                console.error('æµ‹è¯•æ‰§è¡Œé”™è¯¯:', error);
                document.getElementById('testStatus').textContent = 'æµ‹è¯•æ‰§è¡Œå‡ºé”™: ' + error.message;
                document.getElementById('testResults').innerHTML = `<div style="padding: 20px; color: var(--danger);">æµ‹è¯•æ‰§è¡Œå‡ºé”™: ${error.message}</div>`;
            }
        }
        
        /**
         * æ›´æ–°ç»Ÿè®¡æ•°æ®
         */
        function updateStats() {
            const stats = tester.getStats();
            document.getElementById('totalCount').textContent = stats.total;
            document.getElementById('passCount').textContent = stats.passed;
            document.getElementById('failCount').textContent = stats.failed;
            document.getElementById('passRate').textContent = stats.rate + '%';
            
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = stats.rate + '%';
            progressBar.textContent = stats.rate + '%';
            
            if (stats.rate >= 100) {
                progressBar.style.background = 'linear-gradient(90deg, #22c55e, #4ade80)';
            } else if (stats.rate >= 80) {
                progressBar.style.background = 'linear-gradient(90deg, #f59e0b, #fbbf24)';
            } else {
                progressBar.style.background = 'linear-gradient(90deg, #ef4444, #f87171)';
            }
        }
        
        /**
         * æ¸²æŸ“æµ‹è¯•ç»“æœ
         */
        function renderResults() {
            const container = document.getElementById('testResults');
            let html = '';
            
            for (const [category, tests] of Object.entries(tester.categories)) {
                const passed = tests.filter(t => t.passed).length;
                const failed = tests.length - passed;
                
                html += `
                    <div class="test-category">
                        <div class="category-header">
                            <span>${category} (${tests.length})</span>
                            <div class="category-stats">
                                <span class="pass">âœ“ ${passed} é€šè¿‡</span>
                                ${failed > 0 ? `<span class="fail">âœ— ${failed} å¤±è´¥</span>` : ''}
                            </div>
                        </div>
                        <div class="test-items">
                            ${tests.map(t => `
                                <div class="test-item">
                                    <div class="test-icon ${t.passed ? 'pass' : 'fail'}">${t.passed ? 'âœ“' : 'âœ—'}</div>
                                    <div class="test-content">
                                        <div class="test-name">${t.name}</div>
                                        <div class="test-detail ${t.passed ? '' : 'error'}">${t.detail}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        /**
         * å¯¼å‡ºPDF
         */
        function exportPDF() {
            window.print();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(runTests, 500);
        });
    </script>
</body>
</html>
