<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>德国独立储能电站投资测算系统</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // 登录验证 - 页面加载前检查
        (function() {
            if (sessionStorage.getItem('isLoggedIn') !== 'true') {
                window.location.href = 'login.html';
            }
        })();
    </script>
    
    <!-- 语言切换代码 -->
    <style>
        /* 语言切换按钮样式（和登录页完全一致） */
        .language-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            gap: 8px;
            background: rgba(15, 25, 45, 0.9);
            border-radius: 12px;
            padding: 8px;
            border: 1px solid rgba(0, 212, 170, 0.2);
            backdrop-filter: blur(10px);
        }

        .lang-btn {
            padding: 6px 12px;
            border-radius: 8px;
            border: none;
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .lang-btn.active {
            background: rgba(0, 212, 170, 0.2);
            color: #00d4aa;
        }

        .lang-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }

        /* 移动端适配 */
        @media (max-width: 480px) {
            .language-switcher {
                top: 15px;
                right: 15px;
                padding: 6px;
            }
            .lang-btn {
                padding: 4px 8px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- 语言切换按钮（和登录页完全一致） -->
    <div class="language-switcher">
        <button class="lang-btn" data-lang="zh">中文</button>
        <button class="lang-btn" data-lang="en">English</button>
        <button class="lang-btn" data-lang="de">Deutsch</button>
    </div>
    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="nav-brand">
            <span class="brand-icon">⚡</span>
<span class="brand-text" data-i18n="index.brandText">德国独立储能电站投资测算系统</span>
        </div>
        <div class="nav-links">
<!-- 边界设定 -->
<a href="#" class="nav-link active" data-tab="parameters" data-i18n="index.navParameters">边界设定</a>

<!-- OPEX设定 -->
<a href="#" class="nav-link" data-tab="opex" data-i18n="index.navOpex">OPEX设定</a>

<!-- 收入预测 -->
<a href="#" class="nav-link" data-tab="revenue" data-i18n="index.navRevenue">收入预测</a>

<!-- 财务指标 -->
<a href="#" class="nav-link" data-tab="indicators" data-i18n="index.navIndicators">财务指标</a>

<!-- 财务报表 -->
<a href="#" class="nav-link" data-tab="statements" data-i18n="index.navStatements">财务报表</a>

<!-- 敏感性分析 -->
<a href="#" class="nav-link" data-tab="sensitivity" data-i18n="index.navSensitivity">敏感性分析</a>

<!-- 融资报告 -->
<a href="#" class="nav-link" data-tab="bankReport" data-i18n="index.navBankReport">融资报告</a>
        </div>
        <div class="nav-actions">
<!-- 帮助按钮 -->
<button class="action-btn help-btn" onclick="showHelp()" title="使用帮助" data-i18n="index.helpBtn">
  <span>?</span> 帮助
</button>

<!-- 导入模型按钮 -->
<button class="action-btn" onclick="importModel()" title="导入模型" data-i18n="index.importBtn">
  <span>⬆</span> 导入
</button>

<!-- 保存模型按钮 -->
<button class="action-btn" onclick="saveModel()" title="保存模型" data-i18n="index.saveBtn">
  <span>💾</span> 保存
</button>

<!-- 导出报表按钮 -->
<button class="action-btn" onclick="exportReport()" title="导出报表" data-i18n="index.exportReportBtn">
  <span>📤</span> 导出
</button>

<!-- 导出Excel按钮 -->
<button class="action-btn" onclick="exportExcel()" title="导出Excel" data-i18n="index.exportExcelBtn">
  <span>📊</span> Excel
</button>

<!-- 计算按钮 -->
<button class="calculate-btn" onclick="calculateAll()" data-i18n="index.calculateBtn">
  <span>🔄</span> 计算
</button>

<!-- 退出按钮 -->
<button class="logout-btn" onclick="logout()" title="退出登录" data-i18n="index.logoutBtn">
  退出
</button>
            </div>
        </div>
        <!-- 隐藏的文件输入 -->
        <input type="file" id="modelFileInput" accept=".json" style="display:none" onchange="handleModelImport(event)">
    </nav>

    <!-- 主内容区 -->
    <main class="main-content">
        <!-- 边界设定界面 -->
        <section id="parameters" class="tab-content active">
            <div class="section-header">
                <h2 data-i18n="index.parameters.sectionTitle">📊 项目边界条件设定</h2>
                <p class="section-desc" data-i18n="index.parameters.sectionDesc">设置储能电站的基础参数和设备配置</p>
            </div>
            
            <div class="params-grid">
                <!-- 电站基础参数 -->
                <div class="param-card">
                    <div class="card-header">
                        <span class="card-icon">🔋</span>
                        <h3 data-i18n="index.parameters.basicParamsCard">电站基础参数</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label data-i18n="index.parameters.powerLabel">电站装机功率</label>
                            <div class="input-with-unit">
                                <input type="number" id="power_mw" value="100" min="1">
                                <span class="unit">MW</span>
                            </div>
                            <span class="hint" data-i18n="index.parameters.powerHint">德国大型储能项目典型规模</span>
                        </div>
                        <div class="input-group">
                            <label data-i18n="index.parameters.capacityLabel">电站储能容量</label>
                            <div class="input-with-unit">
                                <input type="number" id="capacity_mwh" value="200" min="1">
                                <span class="unit">MWh</span>
                            </div>
                            <span class="hint" data-i18n="index.parameters.capacityHint">2小时储能配置</span>
                        </div>
                        <div class="input-group">
                            <label data-i18n="index.parameters.durationLabel">储能时长</label>
                            <div class="input-with-unit">
                                <input type="number" id="duration_hours" value="2" readonly>
                                <span class="unit">小时</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label data-i18n="index.parameters.operationYearsLabel">电站运营年限</label>
                            <div class="input-with-unit">
                                <input type="number" id="operation_years" value="20" min="1" max="30">
                                <span class="unit">年</span>
                            </div>
                            <span class="hint" data-i18n="index.parameters.operationYearsHint">行业标准运营周期</span>
                        </div>
                        <div class="input-group">
                            <label data-i18n="index.parameters.initialCapacityLabel">首年电池可用容量</label>
                            <div class="input-with-unit">
                                <input type="number" id="initial_capacity_pct" value="100" min="80" max="100">
                                <span class="unit">%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 容量衰减设定 -->
                <div class="param-card">
                    <div class="card-header">
                        <span class="card-icon">📉</span>
                        <h3 data-i18n="index.parameters.degradationCard">容量衰减设定</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label data-i18n="index.parameters.degradationModeLabel">衰减模式</label>
                            <select id="degradation_mode" onchange="onDegradationModeChange()">
                                <option value="linear">线性衰减（固定年衰减率）</option>
                                <option value="nonlinear">非线性衰减（前期快后期慢）</option>
                                <option value="cycle_based">循环次数衰减</option>
                            </select>
                            <span class="hint" data-i18n="index.parameters.degradationModeHint">根据电池特性选择衰减模式</span>
                        </div>
                        <div class="input-group">
                            <label>年电池容量衰减率</label>
                            <div class="input-with-unit">
                                <input type="number" id="degradation_rate" value="2.5" min="0" max="5" step="0.1">
                                <span class="unit">%/年</span>
                            </div>
                            <span class="hint">线性衰减模式：固定年衰减率</span>
                        </div>
                        <div class="input-group" id="degradation_first_year_group" style="display: none;">
                            <label>首年衰减率</label>
                            <div class="input-with-unit">
                                <input type="number" id="degradation_first_year" value="3.0" min="0" max="8" step="0.1">
                                <span class="unit">%/年</span>
                            </div>
                            <span class="hint">非线性衰减：首年衰减率（通常较高）</span>
                        </div>
                        <div class="input-group" id="degradation_annual_decrease_group" style="display: none;">
                            <label>年衰减率递减幅度</label>
                            <div class="input-with-unit">
                                <input type="number" id="degradation_annual_decrease" value="0.1" min="0" max="1" step="0.05">
                                <span class="unit">%/年</span>
                            </div>
                            <span class="hint">非线性衰减：每年衰减率递减幅度</span>
                        </div>
                        <div class="input-group" id="cycles_per_degradation_group" style="display: none;">
                            <label>每1000次循环衰减率</label>
                            <div class="input-with-unit">
                                <input type="number" id="cycles_per_degradation" value="2.0" min="0" max="5" step="0.1">
                                <span class="unit">%/1000次</span>
                            </div>
                            <span class="hint">循环次数衰减：每1000次循环的容量损失</span>
                        </div>
                        <div class="input-group">
                            <label>年运行循环次数</label>
                            <div class="input-with-unit">
                                <input type="number" id="annual_cycles" value="365" min="100" max="730">
                                <span class="unit">次/年</span>
                            </div>
                            <span class="hint">用于循环次数衰减模式计算</span>
                        </div>
                        <div class="input-group">
                            <label>容量保持率阈值</label>
                            <div class="input-with-unit">
                                <input type="number" id="capacity_threshold" value="80" min="60" max="90" step="5">
                                <span class="unit">%</span>
                            </div>
                            <span class="hint">低于此阈值建议更换电池</span>
                        </div>
                    </div>
                </div>

                <!-- 融资参数 -->
                <div class="param-card">
                    <div class="card-header">
                        <span class="card-icon">💰</span>
                        <h3>融资参数</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label>资本金比例</label>
                            <div class="input-with-unit">
                                <input type="number" id="equity_ratio" value="25" min="10" max="100">
                                <span class="unit">%</span>
                            </div>
                            <span class="hint">德国项目融资典型比例25-30%</span>
                        </div>
                        <div class="input-group">
                            <label>贷款年限</label>
                            <div class="input-with-unit">
                                <input type="number" id="loan_years" value="12" min="1" max="25">
                                <span class="unit">年</span>
                            </div>
                            <span class="hint">德国银行储能项目常见贷款期限</span>
                        </div>
                        <div class="input-group">
                            <label>贷款利率</label>
                            <div class="input-with-unit">
                                <input type="number" id="loan_rate" value="4.5" min="0" max="20" step="0.1">
                                <span class="unit">%</span>
                            </div>
                            <span class="hint">2025年欧洲市场基准利率水平</span>
                        </div>
                        <div class="input-group">
                            <label>还款宽限期</label>
                            <div class="input-with-unit">
                                <input type="number" id="grace_period" value="1" min="0" max="5">
                                <span class="unit">年</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>还款方式</label>
                            <select id="repayment_method">
                                <option value="equal_principal">等额本金</option>
                                <option value="equal_payment">等额本息</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 建设期与通胀参数 -->
                <div class="param-card">
                    <div class="card-header">
                        <span class="card-icon">🏗️</span>
                        <h3>建设期与通胀参数</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label>建设期</label>
                            <div class="input-with-unit">
                                <input type="number" id="construction_period" value="1" min="0.5" max="3" step="0.5">
                                <span class="unit">年</span>
                            </div>
                            <span class="hint">项目从开工到投产的时间</span>
                        </div>
                        <div class="input-group">
                            <label>建设期资金占用比例</label>
                            <div class="input-with-unit">
                                <input type="number" id="construction_fund_usage" value="50" min="30" max="100" step="5">
                                <span class="unit">%</span>
                            </div>
                            <span class="hint">建设期平均资金占用比例（用于计算建设期利息）</span>
                        </div>
                        <div class="input-group">
                            <label>通货膨胀率</label>
                            <div class="input-with-unit">
                                <input type="number" id="inflation_rate" value="2.0" min="0" max="10" step="0.1">
                                <span class="unit">%/年</span>
                            </div>
                            <span class="hint">用于OPEX年度增长计算（德国2025年通胀率约2%）</span>
                        </div>
                    </div>
                </div>

                <!-- 折旧参数 -->
                <div class="param-card">
                    <div class="card-header">
                        <span class="card-icon">📉</span>
                        <h3>折旧摊销参数</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label>固定资产折旧年限</label>
                            <div class="input-with-unit">
                                <input type="number" id="depreciation_years" value="15" min="5" max="25">
                                <span class="unit">年</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>残值率</label>
                            <div class="input-with-unit">
                                <input type="number" id="salvage_rate" value="5" min="0" max="20">
                                <span class="unit">%</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>折旧方法</label>
                            <select id="depreciation_method">
                                <option value="straight_line">直线法</option>
                                <option value="double_declining">双倍余额递减法</option>
                                <option value="sum_of_years">年数总和法</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>无形资产摊销年限</label>
                            <div class="input-with-unit">
                                <input type="number" id="amortization_years" value="20" min="5" max="30">
                                <span class="unit">年</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 效率参数 -->
                <div class="param-card">
                    <div class="card-header">
                        <span class="card-icon">⚙️</span>
                        <h3>效率参数</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label>充电效率</label>
                            <div class="input-with-unit">
                                <input type="number" id="charge_efficiency" value="95" min="80" max="100" step="0.1">
                                <span class="unit">%</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>放电效率</label>
                            <div class="input-with-unit">
                                <input type="number" id="discharge_efficiency" value="95" min="80" max="100" step="0.1">
                                <span class="unit">%</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>系统综合效率(RTE)</label>
                            <div class="input-with-unit">
                                <input type="number" id="rte" value="90.25" readonly>
                                <span class="unit">%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 税费参数 -->
                <div class="param-card">
                    <div class="card-header">
                        <span class="card-icon">🏛️</span>
                        <h3>税费参数</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label>企业所得税率(Körperschaftsteuer)</label>
                            <div class="input-with-unit">
                                <input type="number" id="corporate_tax_rate" value="15" min="0" max="35">
                                <span class="unit">%</span>
                            </div>
                            <span class="hint">德国法定企业所得税率</span>
                        </div>
                        <div class="input-group">
                            <label>团结附加税率(Solidaritätszuschlag)</label>
                            <div class="input-with-unit">
                                <input type="number" id="solidarity_tax_rate" value="5.5" min="0" max="10" step="0.1">
                                <span class="unit">%</span>
                            </div>
                            <span class="hint">按企业所得税额的5.5%计算</span>
                        </div>
                        <div class="input-group">
                            <label>贸易税率(Gewerbesteuer)</label>
                            <div class="input-with-unit">
                                <input type="number" id="trade_tax_rate" value="14" min="0" max="20">
                                <span class="unit">%</span>
                            </div>
                            <span class="hint">德国各地市政税率不同(7-17%)</span>
                        </div>
                        <div class="input-group">
                            <label>增值税率(MwSt/VAT)</label>
                            <div class="input-with-unit">
                                <input type="number" id="vat_rate" value="19" min="0" max="25">
                                <span class="unit">%</span>
                            </div>
                            <span class="hint">德国标准增值税率</span>
                        </div>
                        <div class="input-group">
                            <label>其他税费</label>
                            <div class="input-with-unit">
                                <input type="number" id="other_tax_rate" value="0" min="0" max="10">
                                <span class="unit">%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tolling参数 -->
                <div class="param-card">
                    <div class="card-header">
                        <span class="card-icon">📋</span>
                        <h3>Tolling运营参数</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label>Tolling合同年限</label>
                            <div class="input-with-unit">
                                <input type="number" id="tolling_years" value="10" min="0" max="20">
                                <span class="unit">年</span>
                            </div>
                            <span class="hint">德国储能Tolling合约典型期限</span>
                        </div>
                        <div class="input-group">
                            <label>Tolling容量占比</label>
                            <div class="input-with-unit">
                                <input type="number" id="tolling_ratio" value="80" min="0" max="100">
                                <span class="unit">%</span>
                            </div>
                            <span class="hint">银行融资通常要求70-90%</span>
                        </div>
                        <div class="input-group">
                            <label>Tolling价格(首年)</label>
                            <div class="input-with-unit">
                                <input type="number" id="tolling_price" value="95" min="0" step="0.1" title="德国2025年Tolling价格80-110€/kW/年">
                                <span class="unit">EUR/kW/年</span>
                            </div>
                            <span class="hint">德国2025年市场价格70-90€/kW</span>
                        </div>
                        <div class="input-group">
                            <label>Tolling价格年增长率</label>
                            <div class="input-with-unit">
                                <input type="number" id="tolling_escalation" value="2.0" min="-5" max="10" step="0.1">
                                <span class="unit">%</span>
                            </div>
                            <span class="hint">通胀调整系数</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 设备配置 -->
            <div class="section-header" style="margin-top: 30px;">
                <h2>🔌 设备配置</h2>
                <p class="section-desc">配置储能系统主要设备参数</p>
            </div>

            <div class="params-grid">
                <!-- 电池系统 -->
                <div class="param-card">
                    <div class="card-header">
                        <span class="card-icon">🔋</span>
                        <h3>电池系统</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label>电池柜型号</label>
                            <select id="battery_model" onchange="updateBatterySpecs()">
                                <optgroup label="宁德时代 CATL (欧洲主流)">
                                    <option value="CATL_EnerOne_Plus" data-capacity="5.0" data-price="85" selected>CATL EnerOne Plus 5MWh (314Ah) ★推荐</option>
                                    <option value="CATL_EnerC_Plus" data-capacity="6.25" data-price="82">CATL EnerC Plus 6.25MWh (314Ah)</option>
                                    <option value="CATL_EnerD" data-capacity="5.0" data-price="88">CATL EnerD 5MWh (530Ah)</option>
                                    <option value="CATL_TENER" data-capacity="6.25" data-price="80">CATL TENER 6.25MWh (LFP)</option>
                                </optgroup>
                                <optgroup label="比亚迪 BYD (欧洲认可度高)">
                                    <option value="BYD_MC_Cube" data-capacity="2.8" data-price="90">BYD MC Cube 2.8MWh (280Ah)</option>
                                    <option value="BYD_Cube_Pro" data-capacity="3.7" data-price="88">BYD Cube Pro 3.7MWh (302Ah)</option>
                                    <option value="BYD_BatteryBox" data-capacity="1.34" data-price="95">BYD Battery-Box Premium 1.34MWh</option>
                                </optgroup>
                                <optgroup label="亿纬锂能 EVE">
                                    <option value="EVE_LF560K" data-capacity="5.0" data-price="83">EVE LF560K 5MWh (560Ah)</option>
                                    <option value="EVE_LF280K" data-capacity="3.35" data-price="85">EVE LF280K 3.35MWh (280Ah)</option>
                                    <option value="EVE_LF314K" data-capacity="3.76" data-price="84">EVE LF314K 3.76MWh (314Ah)</option>
                                </optgroup>
                                <optgroup label="瑞浦兰钧 REPT">
                                    <option value="REPT_320Ah" data-capacity="3.84" data-price="82">REPT 320Ah 3.84MWh</option>
                                    <option value="REPT_345Ah" data-capacity="4.14" data-price="81">REPT 345Ah 4.14MWh</option>
                                </optgroup>
                                <optgroup label="海辰储能 HiTHIUM">
                                    <option value="HiTHIUM_314Ah" data-capacity="3.76" data-price="83">海辰 314Ah 3.76MWh</option>
                                    <option value="HiTHIUM_560Ah" data-capacity="5.02" data-price="80">海辰 560Ah 5.02MWh</option>
                                </optgroup>
                                <optgroup label="国轩高科 Gotion">
                                    <option value="Gotion_280Ah" data-capacity="3.35" data-price="85">国轩 280Ah 3.35MWh</option>
                                    <option value="Gotion_314Ah" data-capacity="3.76" data-price="83">国轩 314Ah 3.76MWh</option>
                                </optgroup>
                                <optgroup label="三星SDI Samsung (韩系)">
                                    <option value="Samsung_E3" data-capacity="3.92" data-price="98">Samsung SDI E3 3.92MWh</option>
                                </optgroup>
                                <optgroup label="LG新能源 LGES (韩系)">
                                    <option value="LGES_RESU" data-capacity="3.5" data-price="100">LG RESU Prime 3.5MWh</option>
                                </optgroup>
                                <optgroup label="其他">
                                    <option value="CUSTOM" data-capacity="5.0" data-price="85">自定义</option>
                                </optgroup>
                            </select>
                            <span class="hint">2025年德国市场主流供应商</span>
                        </div>
                        <div class="input-group">
                            <label>单柜容量</label>
                            <div class="input-combo">
                                <select id="battery_capacity_select" onchange="onBatteryCapacitySelect()">
                                    <optgroup label="主流容量规格">
                                        <option value="1.34">1.34 MWh</option>
                                        <option value="2.5">2.5 MWh</option>
                                        <option value="2.8">2.8 MWh</option>
                                        <option value="3.35">3.35 MWh</option>
                                        <option value="3.5">3.5 MWh</option>
                                        <option value="3.7">3.7 MWh</option>
                                        <option value="3.76">3.76 MWh</option>
                                        <option value="3.84">3.84 MWh</option>
                                        <option value="3.92">3.92 MWh</option>
                                        <option value="4.14">4.14 MWh</option>
                                        <option value="5.0" selected>5.0 MWh ★主流</option>
                                        <option value="5.02">5.02 MWh</option>
                                        <option value="6.25">6.25 MWh</option>
                                    </optgroup>
                                    <optgroup label="其他">
                                        <option value="custom">手动输入</option>
                                    </optgroup>
                                </select>
                                <div class="input-with-unit">
                                    <input type="number" id="battery_cabinet_capacity" value="5.0" step="0.01" min="0.1" onchange="onBatteryCapacityInput()">
                                    <span class="unit">MWh</span>
                                </div>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>电池柜数量 <button class="auto-calc-btn" onclick="autoCalcBatteryCount()" title="根据总容量自动计算">🔄自动</button></label>
                            <div class="input-with-unit">
                                <input type="number" id="battery_cabinet_count" value="40" min="1">
                                <span class="unit">台</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>电池系统单价</label>
                            <div class="input-with-unit">
                                <input type="number" id="battery_unit_price" value="75" min="0" step="1" title="德国2025年电池系统价格65-90€/kWh">
                                <span class="unit">EUR/kWh</span>
                            </div>
                            <span class="hint">2025年德国市场均价80-95€/kWh</span>
                        </div>
                    </div>
                </div>

                <!-- PCS系统 -->
                <div class="param-card">
                    <div class="card-header">
                        <span class="card-icon">⚡</span>
                        <h3>PCS系统</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label>PCS型号</label>
                            <select id="pcs_model" onchange="updatePCSSpecs()">
                                <optgroup label="阳光电源 Sungrow (德国市场份额领先)">
                                    <option value="Sungrow_ST5220" data-power="5.5" data-price="28" selected>Sungrow ST5220KWH 5.5MW ★推荐</option>
                                    <option value="Sungrow_ST3440" data-power="3.45" data-price="30">Sungrow ST3440KWH 3.45MW</option>
                                    <option value="Sungrow_ST2752" data-power="2.75" data-price="32">Sungrow ST2752KWH 2.75MW</option>
                                    <option value="Sungrow_SC5000" data-power="5.0" data-price="26">Sungrow SC5000UD-MV 5MW (集中式)</option>
                                </optgroup>
                                <optgroup label="华为 Huawei">
                                    <option value="Huawei_LUNA2000" data-power="2.0" data-price="35">Huawei LUNA2000-2.0MW</option>
                                    <option value="Huawei_SmartString" data-power="2.5" data-price="33">Huawei Smart String ESS 2.5MW</option>
                                    <option value="Huawei_FusionPower" data-power="5.0" data-price="28">Huawei FusionPower 5MW</option>
                                </optgroup>
                                <optgroup label="科华数能 KSTAR">
                                    <option value="KSTAR_PCS3450" data-power="3.45" data-price="29">科华 BluE-S 3450kW</option>
                                    <option value="KSTAR_PCS2500" data-power="2.5" data-price="30">科华 BluE-S 2500kW</option>
                                    <option value="KSTAR_PCS5000" data-power="5.0" data-price="26">科华 BluE-M 5000kW</option>
                                </optgroup>
                                <optgroup label="上能电气 Sineng">
                                    <option value="Sineng_ESC3450" data-power="3.45" data-price="29">上能 ESC-3450kW</option>
                                    <option value="Sineng_ESC5000" data-power="5.0" data-price="27">上能 ESC-5000kW</option>
                                </optgroup>
                                <optgroup label="阳光电源 Sungrow (集中式)">
                                    <option value="Sungrow_SC8000" data-power="8.0" data-price="24">Sungrow SC8000UD-MV 8MW</option>
                                </optgroup>
                                <optgroup label="特变电工 TBEA">
                                    <option value="TBEA_TC3450" data-power="3.45" data-price="29">特变 TC-3450ESS 3.45MW</option>
                                    <option value="TBEA_TC5000" data-power="5.0" data-price="26">特变 TC-5000ESS 5MW</option>
                                </optgroup>
                                <optgroup label="盛弘股份 Shoto">
                                    <option value="Shoto_PCS3450" data-power="3.45" data-price="30">盛弘 ETC-3450 3.45MW</option>
                                </optgroup>
                                <optgroup label="南瑞继保 NR">
                                    <option value="NR_PCS3450" data-power="3.45" data-price="31">南瑞继保 PCS-3450 3.45MW</option>
                                </optgroup>
                                <optgroup label="欧洲品牌 (合规性好)">
                                    <option value="SMA_Sunny" data-power="2.5" data-price="42">SMA Sunny Central Storage 2.5MW</option>
                                    <option value="ABB_PCS" data-power="3.0" data-price="45">ABB PCS-3000 3MW</option>
                                    <option value="Siemens_Siestorage" data-power="2.0" data-price="48">Siemens Siestorage 2MW</option>
                                </optgroup>
                                <optgroup label="其他">
                                    <option value="CUSTOM" data-power="5.0" data-price="28">自定义</option>
                                </optgroup>
                            </select>
                            <span class="hint">2025年德国市场主流PCS供应商</span>
                        </div>
                        <div class="input-group">
                            <label>单台PCS功率</label>
                            <div class="input-combo">
                                <select id="pcs_power_select" onchange="onPCSPowerSelect()">
                                    <optgroup label="主流功率规格">
                                        <option value="1.25">1.25 MW</option>
                                        <option value="1.5">1.5 MW</option>
                                        <option value="2.0">2.0 MW</option>
                                        <option value="2.5">2.5 MW</option>
                                        <option value="2.75">2.75 MW</option>
                                        <option value="3.0">3.0 MW</option>
                                        <option value="3.45">3.45 MW</option>
                                        <option value="4.0">4.0 MW</option>
                                        <option value="5.0">5.0 MW</option>
                                        <option value="5.5" selected>5.5 MW ★主流</option>
                                        <option value="6.0">6.0 MW</option>
                                        <option value="8.0">8.0 MW</option>
                                    </optgroup>
                                    <optgroup label="其他">
                                        <option value="custom">手动输入</option>
                                    </optgroup>
                                </select>
                                <div class="input-with-unit">
                                    <input type="number" id="pcs_power" value="5.5" step="0.01" min="0.1" onchange="onPCSPowerInput()">
                                    <span class="unit">MW</span>
                                </div>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>PCS数量 <button class="auto-calc-btn" onclick="autoCalcPCSCount()" title="根据总功率自动计算">🔄自动</button></label>
                            <div class="input-with-unit">
                                <input type="number" id="pcs_count" value="19" min="1">
                                <span class="unit">台</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>PCS单价</label>
                            <div class="input-with-unit">
                                <input type="number" id="pcs_unit_price" value="28" min="0" step="1">
                                <span class="unit">EUR/kW</span>
                            </div>
                            <span class="hint">2025年德国市场均价25-35€/kW</span>
                        </div>
                    </div>
                </div>

                <!-- 变压器系统 -->
                <div class="param-card">
                    <div class="card-header">
                        <span class="card-icon">🔄</span>
                        <h3>中压变压器</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label>中压变型号</label>
                            <select id="mv_transformer_model" onchange="updateMVTransformerSpecs()">
                                <optgroup label="干式变压器 (室内/集装箱) - 德国常用">
                                    <option value="Dry_2500" data-voltage="20" data-capacity="2500" data-price="18000">干式 20kV/2500kVA</option>
                                    <option value="Dry_3150" data-voltage="20" data-capacity="3150" data-price="22000">干式 20kV/3150kVA</option>
                                    <option value="Dry_4000" data-voltage="20" data-capacity="4000" data-price="25000">干式 20kV/4000kVA</option>
                                    <option value="Dry_5000" data-voltage="20" data-capacity="5000" data-price="28000">干式 20kV/5000kVA</option>
                                    <option value="Dry_6300" data-voltage="20" data-capacity="6300" data-price="35000" selected>干式 20kV/6300kVA ★推荐</option>
                                </optgroup>
                                <optgroup label="油浸式变压器 (户外)">
                                    <option value="Oil_2500" data-voltage="20" data-capacity="2500" data-price="15000">油浸 20kV/2500kVA</option>
                                    <option value="Oil_3150" data-voltage="20" data-capacity="3150" data-price="18000">油浸 20kV/3150kVA</option>
                                    <option value="Oil_4000" data-voltage="20" data-capacity="4000" data-price="20000">油浸 20kV/4000kVA</option>
                                    <option value="Oil_5000" data-voltage="20" data-capacity="5000" data-price="24000">油浸 20kV/5000kVA</option>
                                </optgroup>
                                <optgroup label="欧洲品牌 (德国本土认证)">
                                    <option value="Siemens_GEAFOL" data-voltage="20" data-capacity="6300" data-price="45000">西门子 GEAFOL 6300kVA</option>
                                    <option value="ABB_Dry" data-voltage="20" data-capacity="5000" data-price="38000">ABB 干式 5000kVA</option>
                                    <option value="Schneider_Trihal" data-voltage="20" data-capacity="4000" data-price="32000">施耐德 Trihal 4000kVA</option>
                                </optgroup>
                                <optgroup label="国产品牌">
                                    <option value="TBEA_SCB" data-voltage="20" data-capacity="5000" data-price="26000">特变电工 SCB 5000kVA</option>
                                    <option value="BTW_SC" data-voltage="20" data-capacity="5000" data-price="24000">北京变压器 SC 5000kVA</option>
                                    <option value="JiangSu_SCB" data-voltage="20" data-capacity="6300" data-price="32000">江苏华鹏 SCB 6300kVA</option>
                                </optgroup>
                                <optgroup label="其他">
                                    <option value="CUSTOM" data-voltage="20" data-capacity="6300" data-price="35000">自定义</option>
                                </optgroup>
                            </select>
                            <span class="hint">德国常用20kV电压等级</span>
                        </div>
                        <div class="input-group">
                            <label>电压等级</label>
                            <select id="mv_transformer_voltage">
                                <option value="10">10 kV (中国常用)</option>
                                <option value="20" selected>20 kV (德国常用)</option>
                                <option value="30">30 kV (德国)</option>
                                <option value="35">35 kV (中国常用)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>变压器容量</label>
                            <div class="input-combo">
                                <select id="mv_capacity_select" onchange="onMVCapacitySelect()">
                                    <optgroup label="主流容量规格">
                                        <option value="1600">1600 kVA</option>
                                        <option value="2000">2000 kVA</option>
                                        <option value="2500">2500 kVA</option>
                                        <option value="3150">3150 kVA</option>
                                        <option value="4000">4000 kVA</option>
                                        <option value="5000">5000 kVA</option>
                                        <option value="6300" selected>6300 kVA ★主流</option>
                                    </optgroup>
                                    <optgroup label="其他">
                                        <option value="custom">手动输入</option>
                                    </optgroup>
                                </select>
                                <div class="input-with-unit">
                                    <input type="number" id="mv_transformer_capacity" value="6300" min="100" onchange="onMVCapacityInput()">
                                    <span class="unit">kVA</span>
                                </div>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>变压器数量 <button class="auto-calc-btn" onclick="autoCalcMVCount()" title="与PCS数量同步">🔄自动</button></label>
                            <div class="input-with-unit">
                                <input type="number" id="mv_transformer_count" value="19" min="1">
                                <span class="unit">台</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>中压变单价</label>
                            <div class="input-with-unit">
                                <input type="number" id="mv_transformer_price" value="35000" min="0">
                                <span class="unit">EUR/台</span>
                            </div>
                            <span class="hint">德国市场干式变压器价格</span>
                        </div>
                    </div>
                </div>

                <!-- 升压变 -->
                <div class="param-card">
                    <div class="card-header">
                        <span class="card-icon">⬆️</span>
                        <h3>升压变压器</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label>升压变型号</label>
                            <select id="hv_transformer_model" onchange="updateHVTransformerSpecs()">
                                <optgroup label="110kV等级 (德国常用)">
                                    <option value="110kV_50MVA" data-capacity="50" data-price="420000">110kV/50MVA 油浸式</option>
                                    <option value="110kV_63MVA" data-capacity="63" data-price="480000">110kV/63MVA 油浸式</option>
                                    <option value="110kV_80MVA" data-capacity="80" data-price="580000">110kV/80MVA 油浸式</option>
                                    <option value="110kV_100MVA" data-capacity="100" data-price="680000">110kV/100MVA 油浸式</option>
                                    <option value="110kV_120MVA" data-capacity="120" data-price="750000" selected>110kV/120MVA 油浸式 ★推荐</option>
                                    <option value="110kV_150MVA" data-capacity="150" data-price="900000">110kV/150MVA 油浸式</option>
                                </optgroup>
                                <optgroup label="220kV等级 (大型项目)">
                                    <option value="220kV_120MVA" data-capacity="120" data-price="1100000">220kV/120MVA 油浸式</option>
                                    <option value="220kV_150MVA" data-capacity="150" data-price="1300000">220kV/150MVA 油浸式</option>
                                    <option value="220kV_180MVA" data-capacity="180" data-price="1500000">220kV/180MVA 油浸式</option>
                                    <option value="220kV_240MVA" data-capacity="240" data-price="1800000">220kV/240MVA 油浸式</option>
                                </optgroup>
                                <optgroup label="380kV等级 (德国高压电网)">
                                    <option value="380kV_200MVA" data-capacity="200" data-price="2300000">380kV/200MVA 油浸式</option>
                                    <option value="380kV_300MVA" data-capacity="300" data-price="3000000">380kV/300MVA 油浸式</option>
                                </optgroup>
                                <optgroup label="欧洲制造商 (本土认证)">
                                    <option value="Siemens_110_120" data-capacity="120" data-price="850000">西门子 110kV/120MVA</option>
                                    <option value="ABB_110_120" data-capacity="120" data-price="880000">ABB 110kV/120MVA</option>
                                    <option value="Schneider_110_100" data-capacity="100" data-price="720000">施耐德 110kV/100MVA</option>
                                </optgroup>
                                <optgroup label="其他制造商">
                                    <option value="TBEA_110_120" data-capacity="120" data-price="680000">特变电工 110kV/120MVA</option>
                                    <option value="XD_110_120" data-capacity="120" data-price="650000">西电 110kV/120MVA</option>
                                </optgroup>
                                <optgroup label="其他">
                                    <option value="CUSTOM" data-capacity="120" data-price="750000">自定义</option>
                                </optgroup>
                            </select>
                            <span class="hint">德国100MW项目通常接入110kV电网</span>
                        </div>
                        <div class="input-group">
                            <label>升压变容量</label>
                            <div class="input-combo">
                                <select id="hv_capacity_select" onchange="onHVCapacitySelect()">
                                    <optgroup label="110kV等级">
                                        <option value="50">50 MVA</option>
                                        <option value="63">63 MVA</option>
                                        <option value="80">80 MVA</option>
                                        <option value="100">100 MVA</option>
                                        <option value="120" selected>120 MVA ★主流</option>
                                        <option value="150">150 MVA</option>
                                    </optgroup>
                                    <optgroup label="220kV等级">
                                        <option value="180">180 MVA</option>
                                        <option value="200">200 MVA</option>
                                        <option value="240">240 MVA</option>
                                    </optgroup>
                                    <optgroup label="380kV等级">
                                        <option value="300">300 MVA</option>
                                        <option value="400">400 MVA</option>
                                    </optgroup>
                                    <optgroup label="其他">
                                        <option value="custom">手动输入</option>
                                    </optgroup>
                                </select>
                                <div class="input-with-unit">
                                    <input type="number" id="hv_transformer_capacity" value="120" min="10" onchange="onHVCapacityInput()">
                                    <span class="unit">MVA</span>
                                </div>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>升压变数量 <button class="auto-calc-btn" onclick="autoCalcHVCount()" title="根据总容量自动计算">🔄自动</button></label>
                            <div class="input-with-unit">
                                <input type="number" id="hv_transformer_count" value="1" min="1">
                                <span class="unit">台</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>升压变单价</label>
                            <div class="input-with-unit">
                                <input type="number" id="hv_transformer_price" value="750000" min="0">
                                <span class="unit">EUR/台</span>
                            </div>
                            <span class="hint">110kV/120MVA德国市场价格</span>
                        </div>
                    </div>
                </div>

                <!-- 辅助设备 -->
                <div class="param-card">
                    <div class="card-header">
                        <span class="card-icon">🖥️</span>
                        <h3>控制与辅助设备</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label>EMS能量管理系统</label>
                            <div class="input-with-unit">
                                <input type="number" id="ems_cost" value="200000" min="0" step="1000">
                                <span class="unit">EUR</span>
                            </div>
                            <span class="hint">100MW项目EMS系统费用</span>
                        </div>
                        <div class="input-group">
                            <label>SCADA监控系统</label>
                            <div class="input-with-unit">
                                <input type="number" id="scada_cost" value="120000" min="0" step="1000">
                                <span class="unit">EUR</span>
                            </div>
                            <span class="hint">含远程监控与数据采集</span>
                        </div>
                        <div class="input-group">
                            <label>开关柜(中压)</label>
                            <div class="input-with-unit">
                                <input type="number" id="switchgear_price" value="18000" min="0" step="100">
                                <span class="unit">EUR/面</span>
                            </div>
                            <span class="hint">20kV中压开关柜</span>
                        </div>
                        <div class="input-group">
                            <label>开关柜数量</label>
                            <div class="input-with-unit">
                                <input type="number" id="switchgear_count" value="25" min="1">
                                <span class="unit">面</span>
                            </div>
                            <span class="hint">根据PCS数量和配置确定</span>
                        </div>
                        <div class="input-group">
                            <label>集电线路</label>
                            <div class="input-with-unit">
                                <input type="number" id="collector_line_cost" value="250000" min="0" step="1000">
                                <span class="unit">EUR</span>
                            </div>
                            <span class="hint">中压电缆及附件</span>
                        </div>
                        <div class="input-group">
                            <label>热管理系统</label>
                            <div class="input-with-unit">
                                <input type="number" id="thermal_cost" value="20" min="0" step="1">
                                <span class="unit">EUR/kWh</span>
                            </div>
                            <span class="hint">液冷/空调系统(德国气候)</span>
                        </div>
                        <div class="input-group">
                            <label>消防系统</label>
                            <div class="input-with-unit">
                                <input type="number" id="fire_protection_cost" value="12" min="0" step="1">
                                <span class="unit">EUR/kWh</span>
                            </div>
                            <span class="hint">气体灭火+监测系统</span>
                        </div>
                    </div>
                </div>

                <!-- 电网接入 -->
                <div class="param-card">
                    <div class="card-header">
                        <span class="card-icon">🔌</span>
                        <h3>电网接入</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label>变电站建设/扩容</label>
                            <div class="input-with-unit">
                                <input type="number" id="substation_cost" value="800000" min="0" step="10000">
                                <span class="unit">EUR</span>
                            </div>
                            <span class="hint">110kV变电站间隔扩建费</span>
                        </div>
                        <div class="input-group">
                            <label>接入线路</label>
                            <div class="input-with-unit">
                                <input type="number" id="grid_line_cost" value="500000" min="0" step="10000">
                                <span class="unit">EUR</span>
                            </div>
                            <span class="hint">110kV架空/电缆线路</span>
                        </div>
                        <div class="input-group">
                            <label>并网申请与研究费</label>
                            <div class="input-with-unit">
                                <input type="number" id="grid_study_cost" value="80000" min="0" step="1000">
                                <span class="unit">EUR</span>
                            </div>
                            <span class="hint">Netzverträglichkeitsprüfung</span>
                        </div>
                        <div class="input-group">
                            <label>计量与保护设备</label>
                            <div class="input-with-unit">
                                <input type="number" id="metering_cost" value="100000" min="0" step="1000">
                                <span class="unit">EUR</span>
                            </div>
                            <span class="hint">符合德国电网规范要求</span>
                        </div>
                    </div>
                </div>

                <!-- 土地与基建 -->
                <div class="param-card">
                    <div class="card-header">
                        <span class="card-icon">🏗️</span>
                        <h3>土地与基础建设</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label>土地获取成本</label>
                            <div class="input-with-unit">
                                <input type="number" id="land_acquisition_cost" value="50" min="0" step="10">
                                <span class="unit">EUR/kW</span>
                            </div>
                            <span class="hint">德国工业用地购买或长期租赁</span>
                        </div>
                        <div class="input-group">
                            <label>混凝土基础</label>
                            <div class="input-with-unit">
                                <input type="number" id="concrete_cost" value="25" min="0" step="1">
                                <span class="unit">EUR/kW</span>
                            </div>
                            <span class="hint">设备基础及电缆沟</span>
                        </div>
                        <div class="input-group">
                            <label>围栏与安防</label>
                            <div class="input-with-unit">
                                <input type="number" id="fence_cost" value="80000" min="0" step="1000">
                                <span class="unit">EUR</span>
                            </div>
                            <span class="hint">含监控和门禁系统</span>
                        </div>
                        <div class="input-group">
                            <label>道路建设</label>
                            <div class="input-with-unit">
                                <input type="number" id="road_cost" value="120000" min="0" step="1000">
                                <span class="unit">EUR</span>
                            </div>
                            <span class="hint">场内道路及出入口</span>
                        </div>
                        <div class="input-group">
                            <label>排水系统</label>
                            <div class="input-with-unit">
                                <input type="number" id="drainage_cost" value="50000" min="0" step="1000">
                                <span class="unit">EUR</span>
                            </div>
                            <span class="hint">雨水收集及排放系统</span>
                        </div>
                    </div>
                </div>

                <!-- 安装与施工 -->
                <div class="param-card">
                    <div class="card-header">
                        <span class="card-icon">👷</span>
                        <h3>安装与施工管理</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label>机电安装</label>
                            <div class="input-with-unit">
                                <input type="number" id="installation_cost_pct" value="6" min="0" max="20" step="0.5">
                                <span class="unit">%设备费</span>
                            </div>
                            <span class="hint">德国本地安装人工费用较高</span>
                        </div>
                        <div class="input-group">
                            <label>施工管理费</label>
                            <div class="input-with-unit">
                                <input type="number" id="construction_mgmt_pct" value="2.5" min="0" max="10" step="0.5">
                                <span class="unit">%设备费</span>
                            </div>
                            <span class="hint">现场监理与协调</span>
                        </div>
                        <div class="input-group">
                            <label>调试费用</label>
                            <div class="input-with-unit">
                                <input type="number" id="commissioning_cost" value="150000" min="0" step="10000">
                                <span class="unit">EUR</span>
                            </div>
                            <span class="hint">含并网测试和性能验收</span>
                        </div>
                    </div>
                </div>

                <!-- 保险费用 -->
                <div class="param-card">
                    <div class="card-header">
                        <span class="card-icon">🛡️</span>
                        <h3>建设期保险</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label>建设工程一切险(CAR)</label>
                            <div class="input-with-unit">
                                <input type="number" id="car_insurance_pct" value="0.30" min="0" max="2" step="0.05">
                                <span class="unit">%设备费</span>
                            </div>
                            <span class="hint">Bauleistungsversicherung</span>
                        </div>
                        <div class="input-group">
                            <label>安装工程一切险(EAR)</label>
                            <div class="input-with-unit">
                                <input type="number" id="ear_insurance_pct" value="0.20" min="0" max="2" step="0.05">
                                <span class="unit">%设备费</span>
                            </div>
                            <span class="hint">Montageversicherung</span>
                        </div>
                        <div class="input-group">
                            <label>货物运输保险</label>
                            <div class="input-with-unit">
                                <input type="number" id="cargo_insurance_pct" value="0.15" min="0" max="1" step="0.05">
                                <span class="unit">%设备费</span>
                            </div>
                            <span class="hint">Transportversicherung</span>
                        </div>
                        <div class="input-group">
                            <label>第三方责任险</label>
                            <div class="input-with-unit">
                                <input type="number" id="liability_insurance" value="50000" min="0" step="5000">
                                <span class="unit">EUR</span>
                            </div>
                            <span class="hint">Haftpflichtversicherung</span>
                        </div>
                    </div>
                </div>

                <!-- 开发与业主费用 -->
                <div class="param-card">
                    <div class="card-header">
                        <span class="card-icon">📋</span>
                        <h3>开发与业主费用</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label>SPV公司收购成本</label>
                            <div class="input-with-unit">
                                <input type="number" id="spv_acquisition_cost" value="50000" min="0" step="5000">
                                <span class="unit">EUR</span>
                            </div>
                            <span class="hint">特殊目的公司收购及相关费用</span>
                        </div>
                        <div class="input-group">
                            <label>许可与规划费</label>
                            <div class="input-with-unit">
                                <input type="number" id="permit_cost" value="180000" min="0" step="10000">
                                <span class="unit">EUR</span>
                            </div>
                            <span class="hint">BImSchG许可申请费用</span>
                        </div>
                        <div class="input-group">
                            <label>环境咨询费</label>
                            <div class="input-with-unit">
                                <input type="number" id="environmental_cost" value="60000" min="0" step="5000">
                                <span class="unit">EUR</span>
                            </div>
                            <span class="hint">环境影响评估(UVP)</span>
                        </div>
                        <div class="input-group">
                            <label>项目管理费</label>
                            <div class="input-with-unit">
                                <input type="number" id="project_mgmt_pct" value="2" min="0" max="10" step="0.5">
                                <span class="unit">%总投资</span>
                            </div>
                            <span class="hint">业主工程管理团队</span>
                        </div>
                        <div class="input-group">
                            <label>法律咨询费</label>
                            <div class="input-with-unit">
                                <input type="number" id="legal_cost" value="100000" min="0" step="5000">
                                <span class="unit">EUR</span>
                            </div>
                            <span class="hint">合同、许可、融资法律服务</span>
                        </div>
                        <div class="input-group">
                            <label>工程设计费</label>
                            <div class="input-with-unit">
                                <input type="number" id="engineering_pct" value="2.5" min="0" max="10" step="0.5">
                                <span class="unit">%设备费</span>
                            </div>
                            <span class="hint">详细工程设计(FEED)</span>
                        </div>
                        <div class="input-group">
                            <label>不可预见费</label>
                            <div class="input-with-unit">
                                <input type="number" id="contingency_pct" value="5" min="0" max="15" step="0.5">
                                <span class="unit">%小计</span>
                            </div>
                            <span class="hint">银行通常要求5-10%</span>
                        </div>
                    </div>
                </div>

                <!-- 拆除准备金（按年摊销） -->
                <div class="param-card">
                    <div class="card-header">
                        <span class="card-icon">🔧</span>
                        <h3>拆除准备金（按年摊销）</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label>拆除准备金总额</label>
                            <div class="input-with-unit">
                                <input type="number" id="decommissioning_total" value="500000" min="0" step="10000">
                                <span class="unit">EUR</span>
                            </div>
                            <span class="hint">按运营年限平均摊销计入OPEX</span>
                        </div>
                    </div>
                </div>

                <!-- CAPEX明细 -->
                <div class="param-card wide">
                    <div class="card-header">
                        <span class="card-icon">💶</span>
                        <h3>CAPEX明细</h3>
                    </div>
                    <div class="card-body">
                        <table class="capex-table">
                            <thead>
                                <tr>
                                    <th>项目</th>
                                    <th>单价</th>
                                    <th>数量/容量</th>
                                    <th>金额(万EUR)</th>
                                </tr>
                            </thead>
                            <tbody id="capex_breakdown">
                                <!-- 动态生成 -->
                            </tbody>
                            <tfoot>
                                <tr class="total-row">
                                    <td colspan="3">总投资(静态)</td>
                                    <td id="total_capex">-</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- OPEX设定界面 -->
        <section id="opex" class="tab-content">
            <div class="section-header">
                <h2>📋 运营成本设定 (OPEX)</h2>
                <p class="section-desc">设置各项年度运营费用</p>
            </div>

            <div class="params-grid">
                <div class="param-card wide">
                    <div class="card-header">
                        <span class="card-icon">🛠️</span>
                        <h3>运营费用基准设定</h3>
                    </div>
                    <div class="card-body">
                        <table class="opex-table">
                            <thead>
                                <tr>
                                    <th>费用类别</th>
                                    <th>计费基准</th>
                                    <th>首年费率/金额</th>
                                    <th>年增长率(%)</th>
                                    <th>说明</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>技术与运维 (Technical O&M)</td>
                                    <td>EUR/kW/年</td>
                                    <td><input type="number" id="opex_technical" value="6" min="0" step="0.1" title="德国市场主流价格5-8€/kW/年"></td>
                                    <td><input type="number" id="opex_technical_esc" value="2" min="-5" max="10" step="0.1"></td>
                                    <td>设备监控与现场维护 (德国5-8€/kW/年)</td>
                                </tr>
                                <tr>
                                    <td>保险费用 (Insurance)</td>
                                    <td>CAPEX的%/年</td>
                                    <td><input type="number" id="opex_insurance" value="0.4" min="0" step="0.01" title="德国储能项目资产险0.35-0.5%"></td>
                                    <td><input type="number" id="opex_insurance_esc" value="1.5" min="-5" max="10" step="0.1"></td>
                                    <td>资产综合保险 (Sachversicherung 0.35-0.5%)</td>
                                </tr>
                                <tr>
                                    <td>电网运营费 (Grid Fees)</td>
                                    <td>EUR/MW/年</td>
                                    <td><input type="number" id="opex_grid" value="12000" min="0" step="100" title="德国电网使用费10-15k€/MW/年"></td>
                                    <td><input type="number" id="opex_grid_esc" value="2" min="-5" max="10" step="0.1"></td>
                                    <td>Netzentgelte 年度输配电费 (10-15k€/MW)</td>
                                </tr>
                                <tr>
                                    <td>土地租赁 (Land Lease)</td>
                                    <td>EUR/年(总计)</td>
                                    <td><input type="number" id="opex_land" value="60000" min="0" step="1000" title="德国工业用地租金因地区差异大"></td>
                                    <td><input type="number" id="opex_land_esc" value="2" min="-5" max="10" step="0.1"></td>
                                    <td>Pachtgebühren 年租金 (视地区而定)</td>
                                </tr>
                                <tr>
                                    <td>商务与管理 (Commercial O&M)</td>
                                    <td>EUR/MW/年</td>
                                    <td><input type="number" id="opex_commercial" value="4000" min="0" step="100" title="财务、税务、合同管理"></td>
                                    <td><input type="number" id="opex_commercial_esc" value="2" min="-5" max="10" step="0.1"></td>
                                    <td>财务结算、税务及合同管理 (3-5k€/MW)</td>
                                </tr>
                                <tr>
                                    <td>其他运营费</td>
                                    <td>EUR/MW/年</td>
                                    <td><input type="number" id="opex_other" value="1500" min="0" step="100" title="备品备件、杂费等"></td>
                                    <td><input type="number" id="opex_other_esc" value="2" min="-5" max="10" step="0.1"></td>
                                    <td>备品备件、杂费等 (1-2k€/MW)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- OPEX年度明细 -->
                <div class="param-card wide">
                    <div class="card-header">
                        <span class="card-icon">📊</span>
                        <h3>OPEX年度明细表</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-scroll">
                            <table class="yearly-table" id="opex_yearly_table">
                                <thead>
                                    <tr>
                                        <th>年份</th>
                                        <th>技术运维</th>
                                        <th>保险费</th>
                                        <th>电网费</th>
                                        <th>土地租赁</th>
                                        <th>商务管理</th>
                                        <th>其他</th>
                                        <th>拆除准备金</th>
                                        <th>合计</th>
                                    </tr>
                                </thead>
                                <tbody id="opex_yearly_body">
                                    <!-- 动态生成 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 收入预测界面 -->
        <section id="revenue" class="tab-content">
            <div class="section-header">
                <h2>💵 收入预测</h2>
                <p class="section-desc">设置Tolling收入和现货交易收入预测</p>
            </div>

            <div class="params-grid">
                <!-- 现货交易价格 -->
                <div class="param-card wide">
                    <div class="card-header">
                        <span class="card-icon">📈</span>
                        <h3>现货交易收入预测 (非Tolling部分)</h3>
                    </div>
                    <div class="card-body">
                        <p class="hint-text">剩余电量参与现货市场交易，请输入每MW每年的预期收入</p>
                        <div class="table-scroll">
                            <table class="yearly-table" id="spot_price_table">
                                <thead>
                                    <tr>
                                        <th>年份</th>
                                        <th>现货收入单价<br>(EUR/MW/年)</th>
                                        <th>年份</th>
                                        <th>现货收入单价<br>(EUR/MW/年)</th>
                                    </tr>
                                </thead>
                                <tbody id="spot_price_body">
                                    <!-- 动态生成 -->
                                </tbody>
                            </table>
                        </div>
                        <div class="quick-fill">
                            <label>快速填充: 首年价格</label>
                            <input type="number" id="spot_base_price" value="45000" min="0" title="德国2025年现货市场套利收入预期35-55k€/MW/年">
                            <label>年增长率(%)</label>
                            <input type="number" id="spot_escalation" value="1.5" min="-10" max="20" step="0.1">
                            <button class="btn-secondary" onclick="fillSpotPrices()">应用</button>
                            <span class="hint" style="display:block; margin-top:5px;">德国现货市场套利收入：30-45k€/MW/年 (2025年预期)</span>
                        </div>
                    </div>
                </div>

                <!-- 收入年度明细 -->
                <div class="param-card wide">
                    <div class="card-header">
                        <span class="card-icon">💰</span>
                        <h3>收入年度明细表</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-scroll">
                            <table class="yearly-table" id="revenue_yearly_table">
                                <thead>
                                    <tr>
                                        <th>年份</th>
                                        <th>可用容量(%)</th>
                                        <th>Tolling收入<br>(万EUR)</th>
                                        <th>现货收入<br>(万EUR)</th>
                                        <th>总收入<br>(万EUR)</th>
                                    </tr>
                                </thead>
                                <tbody id="revenue_yearly_body">
                                    <!-- 动态生成 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 收入图表 -->
            <div class="chart-container">
                <canvas id="revenueChart"></canvas>
            </div>
        </section>

        <!-- 财务指标界面 -->
        <section id="indicators" class="tab-content">
            <div class="section-header">
                <h2>📊 核心财务指标</h2>
                <p class="section-desc">投资收益及风险评估关键指标</p>
            </div>

            <div class="indicators-grid">
                <div class="indicator-card highlight">
                    <div class="indicator-icon">💰</div>
                    <div class="indicator-label">投资总额（静态）</div>
                    <div class="indicator-value" id="ind_static_investment">-</div>
                    <div class="indicator-unit">万EUR</div>
                </div>
                <div class="indicator-card highlight">
                    <div class="indicator-icon">📈</div>
                    <div class="indicator-label">投资总额（动态）</div>
                    <div class="indicator-value" id="ind_dynamic_investment">-</div>
                    <div class="indicator-unit">万EUR</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-icon">💵</div>
                    <div class="indicator-label">累计销售收入总额</div>
                    <div class="indicator-value" id="ind_total_revenue">-</div>
                    <div class="indicator-unit">万EUR</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-icon">📊</div>
                    <div class="indicator-label">年均销售收入</div>
                    <div class="indicator-value" id="ind_avg_revenue">-</div>
                    <div class="indicator-unit">万EUR</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-icon">🔢</div>
                    <div class="indicator-label">前三年合计销售收入</div>
                    <div class="indicator-value" id="ind_first3_revenue">-</div>
                    <div class="indicator-unit">万EUR</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-icon">💹</div>
                    <div class="indicator-label">累计利润总额</div>
                    <div class="indicator-value" id="ind_total_profit">-</div>
                    <div class="indicator-unit">万EUR</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-icon">📉</div>
                    <div class="indicator-label">年均利润总额</div>
                    <div class="indicator-value" id="ind_avg_profit">-</div>
                    <div class="indicator-unit">万EUR</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-icon">🎯</div>
                    <div class="indicator-label">前三年合计利润总额</div>
                    <div class="indicator-value" id="ind_first3_profit">-</div>
                    <div class="indicator-unit">万EUR</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-icon">✨</div>
                    <div class="indicator-label">累计净利润</div>
                    <div class="indicator-value" id="ind_total_net_profit">-</div>
                    <div class="indicator-unit">万EUR</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-icon">⭐</div>
                    <div class="indicator-label">年均净利润</div>
                    <div class="indicator-value" id="ind_avg_net_profit">-</div>
                    <div class="indicator-unit">万EUR</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-icon">🌟</div>
                    <div class="indicator-label">前三年合计净利润</div>
                    <div class="indicator-value" id="ind_first3_net_profit">-</div>
                    <div class="indicator-unit">万EUR</div>
                </div>
                <div class="indicator-card key-indicator">
                    <div class="indicator-icon">🎯</div>
                    <div class="indicator-label">全投资内部收益率(税后)</div>
                    <div class="indicator-value" id="ind_project_irr">-</div>
                    <div class="indicator-unit">%</div>
                </div>
                <div class="indicator-card key-indicator">
                    <div class="indicator-icon">🏆</div>
                    <div class="indicator-label">资本金内部收益率(税后)</div>
                    <div class="indicator-value" id="ind_equity_irr">-</div>
                    <div class="indicator-unit">%</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-icon">⏱️</div>
                    <div class="indicator-label">全投资回收期(静态)</div>
                    <div class="indicator-value" id="ind_static_payback">-</div>
                    <div class="indicator-unit">年</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-icon">⏳</div>
                    <div class="indicator-label">资本金回收期(静态)</div>
                    <div class="indicator-value" id="ind_equity_payback">-</div>
                    <div class="indicator-unit">年</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-icon">🔄</div>
                    <div class="indicator-label">全投资回收期(动态-8%)</div>
                    <div class="indicator-value" id="ind_dynamic_payback">-</div>
                    <div class="indicator-unit">年</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-icon">🔁</div>
                    <div class="indicator-label">资本金回收期(动态-8%)</div>
                    <div class="indicator-value" id="ind_equity_dynamic_payback">-</div>
                    <div class="indicator-unit">年</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-icon">📊</div>
                    <div class="indicator-label">第三年净资产收益率(ROE)</div>
                    <div class="indicator-value" id="ind_roe_year3">-</div>
                    <div class="indicator-unit">%</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-icon">💎</div>
                    <div class="indicator-label">总投资收益率(ROI)</div>
                    <div class="indicator-value" id="ind_roi">-</div>
                    <div class="indicator-unit">%</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-icon">📈</div>
                    <div class="indicator-label">EBITDA回报率</div>
                    <div class="indicator-value" id="ind_ebitda_return">-</div>
                    <div class="indicator-unit">%</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-icon">⚡</div>
                    <div class="indicator-label">LCOE（平准化度电成本）</div>
                    <div class="indicator-value" id="ind_lcoe">-</div>
                    <div class="indicator-unit">EUR/MWh</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-icon">🛡️</div>
                    <div class="indicator-label">债务偿付覆盖率(DSCR)</div>
                    <div class="indicator-value" id="ind_dscr">-</div>
                    <div class="indicator-unit">倍</div>
                </div>
            </div>
        </section>

        <!-- 财务报表界面 -->
        <section id="statements" class="tab-content">
            <div class="section-header">
                <h2>📑 财务报表</h2>
                <p class="section-desc">利润表、资产负债表、现金流量表</p>
            </div>

            <div class="statement-tabs">
                <button class="statement-tab active" onclick="switchStatement('income')">利润表</button>
                <button class="statement-tab" onclick="switchStatement('balance')">资产负债表</button>
                <button class="statement-tab" onclick="switchStatement('cashflow')">现金流量表</button>
                <button class="statement-tab" onclick="switchStatement('loan')">贷款还款计划表</button>
            </div>

            <!-- 利润表 -->
            <div id="income_statement" class="statement-content active">
                <div class="table-scroll">
                    <table class="statement-table" id="income_table">
                        <thead>
                            <tr>
                                <th>项目</th>
                                <!-- 动态生成年份列 -->
                            </tr>
                        </thead>
                        <tbody id="income_body">
                            <!-- 动态生成 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 资产负债表 -->
            <div id="balance_statement" class="statement-content">
                <div class="table-scroll">
                    <table class="statement-table" id="balance_table">
                        <thead>
                            <tr>
                                <th>项目</th>
                            </tr>
                        </thead>
                        <tbody id="balance_body">
                            <!-- 动态生成 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 现金流量表 -->
            <div id="cashflow_statement" class="statement-content">
                <div class="table-scroll">
                    <table class="statement-table" id="cashflow_table">
                        <thead>
                            <tr>
                                <th>项目</th>
                            </tr>
                        </thead>
                        <tbody id="cashflow_body">
                            <!-- 动态生成 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 贷款还款计划表 -->
            <div id="loan_statement" class="statement-content">
                <div class="table-scroll">
                    <table class="statement-table" id="loan_table">
                        <thead>
                            <tr>
                                <th>年份</th>
                                <th>期初余额</th>
                                <th>本期利息</th>
                                <th>本期还本</th>
                                <th>本期还款额</th>
                                <th>期末余额</th>
                            </tr>
                        </thead>
                        <tbody id="loan_body">
                            <!-- 动态生成 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- 敏感性分析界面 -->
        <section id="sensitivity" class="tab-content">
            <div class="section-header">
                <h2>🔍 敏感性分析</h2>
                <p class="section-desc">分析关键参数变化对投资收益的影响</p>
            </div>

            <div class="sensitivity-config">
                <div class="param-card">
                    <div class="card-header">
                        <span class="card-icon">⚙️</span>
                        <h3>分析参数设置</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label>分析变量1</label>
                            <select id="sens_var1">
                                <option value="capex">投资成本(CAPEX)</option>
                                <option value="tolling_price">Tolling价格</option>
                                <option value="spot_price">现货价格</option>
                                <option value="opex">运营成本(OPEX)</option>
                                <option value="loan_rate">贷款利率</option>
                                <option value="degradation">电池衰减率</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>分析变量2 (可选)</label>
                            <select id="sens_var2">
                                <option value="">不选择</option>
                                <option value="capex">投资成本(CAPEX)</option>
                                <option value="tolling_price">Tolling价格</option>
                                <option value="spot_price">现货价格</option>
                                <option value="opex">运营成本(OPEX)</option>
                                <option value="loan_rate">贷款利率</option>
                                <option value="degradation">电池衰减率</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>分析目标指标</label>
                            <select id="sens_target">
                                <option value="project_irr">全投资IRR</option>
                                <option value="equity_irr">资本金IRR</option>
                                <option value="npv">项目NPV</option>
                                <option value="payback">投资回收期</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>变化范围</label>
                            <div class="range-inputs">
                                <input type="number" id="sens_min" value="-30" min="-50" max="0">
                                <span>%</span>
                                <span>至</span>
                                <input type="number" id="sens_max" value="30" min="0" max="50">
                                <span>%</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>步长</label>
                            <div class="input-with-unit">
                                <input type="number" id="sens_step" value="10" min="5" max="20">
                                <span class="unit">%</span>
                            </div>
                        </div>
                        <button class="btn-primary" onclick="runSensitivityAnalysis()">运行分析</button>
                    </div>
                </div>

                <!-- 敏感性分析结果 -->
                <div class="param-card wide">
                    <div class="card-header">
                        <span class="card-icon">📊</span>
                        <h3>分析结果</h3>
                    </div>
                    <div class="card-body">
                        <div id="sensitivity_result">
                            <p class="hint-text">请选择分析参数并点击"运行分析"</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 敏感性图表 -->
            <div class="chart-container">
                <canvas id="sensitivityChart"></canvas>
            </div>

            <!-- 双变量敏感性矩阵 -->
            <div class="param-card wide" id="sensitivity_matrix_card" style="display: none;">
                <div class="card-header">
                    <span class="card-icon">🎯</span>
                    <h3>双变量敏感性矩阵</h3>
                </div>
                <div class="card-body">
                    <div class="table-scroll">
                        <table class="sensitivity-matrix" id="sensitivity_matrix">
                            <!-- 动态生成 -->
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- 融资报告界面 - 面向银行审批 -->
        <section id="bankReport" class="tab-content">
            <!-- 报告头部 -->
            <div class="report-header">
                <div class="report-logo">
                    <span class="logo-icon">🏦</span>
                    <div class="logo-text">
                        <h1>项目融资可行性分析报告</h1>
                        <p>Battery Energy Storage System (BESS) Project Financing Report</p>
                    </div>
                </div>
                <div class="report-meta">
                    <div class="meta-item">
                        <span class="meta-label">报告日期</span>
                        <span class="meta-value" id="report_date">-</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">报告版本</span>
                        <span class="meta-value">V1.0</span>
                    </div>
                </div>
            </div>

            <!-- 项目概要 -->
            <div class="report-section">
                <div class="section-title">
                    <span class="title-icon">📋</span>
                    <h2>一、项目概要 (Executive Summary)</h2>
                </div>
                <div class="summary-grid">
                    <div class="summary-card">
                        <div class="summary-header">项目基本信息</div>
                        <table class="summary-table">
                            <tr><td>项目名称</td><td id="rpt_project_name">德国独立储能电站项目</td></tr>
                            <tr><td>项目地点</td><td>德国 (Germany)</td></tr>
                            <tr><td>装机规模</td><td id="rpt_capacity">-</td></tr>
                            <tr><td>储能时长</td><td id="rpt_duration">-</td></tr>
                            <tr><td>运营期限</td><td id="rpt_operation_years">-</td></tr>
                            <tr><td>项目公司</td><td>SPV GmbH</td></tr>
                        </table>
                    </div>
                    <div class="summary-card">
                        <div class="summary-header">投资与融资结构</div>
                        <table class="summary-table">
                            <tr><td>项目总投资</td><td id="rpt_total_investment">-</td></tr>
                            <tr><td>资本金</td><td id="rpt_equity">-</td></tr>
                            <tr><td>银行贷款</td><td id="rpt_loan">-</td></tr>
                            <tr><td>资本金比例</td><td id="rpt_equity_ratio">-</td></tr>
                            <tr><td>贷款期限</td><td id="rpt_loan_term">-</td></tr>
                            <tr><td>贷款利率</td><td id="rpt_loan_rate">-</td></tr>
                        </table>
                    </div>
                    <div class="summary-card highlight-card">
                        <div class="summary-header">核心投资指标</div>
                        <table class="summary-table">
                            <tr class="key-row"><td>全投资IRR (税后)</td><td id="rpt_project_irr">-</td></tr>
                            <tr class="key-row"><td>资本金IRR (税后)</td><td id="rpt_equity_irr">-</td></tr>
                            <tr><td>静态投资回收期</td><td id="rpt_payback">-</td></tr>
                            <tr><td>动态投资回收期(8%)</td><td id="rpt_dynamic_payback">-</td></tr>
                            <tr class="key-row"><td>平均DSCR</td><td id="rpt_dscr">-</td></tr>
                            <tr><td>LCOE（平准化度电成本）</td><td id="rpt_lcoe">-</td></tr>
                            <tr><td>最低DSCR</td><td id="rpt_min_dscr">-</td></tr>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 收入结构分析 -->
            <div class="report-section">
                <div class="section-title">
                    <span class="title-icon">💰</span>
                    <h2>二、收入结构分析 (Revenue Analysis)</h2>
                </div>
                <div class="report-grid">
                    <div class="report-card">
                        <h3>收入来源构成</h3>
                        <div class="chart-wrapper">
                            <canvas id="bankRevenueSourceChart"></canvas>
                        </div>
                    </div>
                    <div class="report-card">
                        <h3>年度收入预测</h3>
                        <div class="chart-wrapper">
                            <canvas id="bankRevenueYearlyChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="report-card wide">
                    <h3>收入稳定性评估</h3>
                    <div class="stability-grid">
                        <div class="stability-item">
                            <div class="stability-label">Tolling合同覆盖</div>
                            <div class="stability-bar">
                                <div class="bar-fill" id="tolling_coverage_bar"></div>
                            </div>
                            <div class="stability-value" id="rpt_tolling_coverage">-</div>
                        </div>
                        <div class="stability-item">
                            <div class="stability-label">Tolling收入占比</div>
                            <div class="stability-bar">
                                <div class="bar-fill bar-secondary" id="tolling_ratio_bar"></div>
                            </div>
                            <div class="stability-value" id="rpt_tolling_ratio">-</div>
                        </div>
                        <div class="stability-item">
                            <div class="stability-label">收入波动系数</div>
                            <div class="stability-value" id="rpt_revenue_volatility">-</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 偿债能力分析 -->
            <div class="report-section">
                <div class="section-title">
                    <span class="title-icon">🛡️</span>
                    <h2>三、偿债能力分析 (Debt Service Analysis)</h2>
                </div>
                <div class="report-grid">
                    <div class="report-card">
                        <h3>年度DSCR趋势</h3>
                        <div class="chart-wrapper">
                            <canvas id="bankDSCRChart"></canvas>
                        </div>
                    </div>
                    <div class="report-card">
                        <h3>现金流覆盖分析</h3>
                        <div class="chart-wrapper">
                            <canvas id="bankCashCoverageChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="report-card wide">
                    <h3>贷款偿还计划表</h3>
                    <div class="table-scroll">
                        <table class="bank-table" id="bank_loan_schedule">
                            <thead>
                                <tr>
                                    <th>年份</th>
                                    <th>期初本金余额<br>(万EUR)</th>
                                    <th>年度利息<br>(万EUR)</th>
                                    <th>年度还本<br>(万EUR)</th>
                                    <th>年度还款额<br>(万EUR)</th>
                                    <th>期末本金余额<br>(万EUR)</th>
                                    <th>EBITDA<br>(万EUR)</th>
                                    <th>DSCR</th>
                                </tr>
                            </thead>
                            <tbody id="bank_loan_body">
                                <!-- 动态生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 盈利能力分析 -->
            <div class="report-section">
                <div class="section-title">
                    <span class="title-icon">📈</span>
                    <h2>四、盈利能力分析 (Profitability Analysis)</h2>
                </div>
                <div class="report-grid">
                    <div class="report-card">
                        <h3>年度利润趋势</h3>
                        <div class="chart-wrapper">
                            <canvas id="bankProfitChart"></canvas>
                        </div>
                    </div>
                    <div class="report-card">
                        <h3>累计现金流</h3>
                        <div class="chart-wrapper">
                            <canvas id="bankCumulativeCFChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="profitability-summary">
                    <div class="profit-metric">
                        <div class="metric-value" id="rpt_avg_ebitda">-</div>
                        <div class="metric-label">年均EBITDA<br>(万EUR)</div>
                    </div>
                    <div class="profit-metric">
                        <div class="metric-value" id="rpt_avg_net_profit">-</div>
                        <div class="metric-label">年均净利润<br>(万EUR)</div>
                    </div>
                    <div class="profit-metric">
                        <div class="metric-value" id="rpt_ebitda_margin">-</div>
                        <div class="metric-label">EBITDA利润率<br>(%)</div>
                    </div>
                    <div class="profit-metric">
                        <div class="metric-value" id="rpt_net_margin">-</div>
                        <div class="metric-label">净利润率<br>(%)</div>
                    </div>
                </div>
            </div>

            <!-- 风险分析 -->
            <div class="report-section">
                <div class="section-title">
                    <span class="title-icon">⚠️</span>
                    <h2>五、风险分析与压力测试 (Risk Analysis)</h2>
                </div>
                <div class="report-card wide">
                    <h3>关键指标敏感性分析</h3>
                    <div class="chart-wrapper large">
                        <canvas id="bankSensitivityChart"></canvas>
                    </div>
                </div>
                <div class="report-grid">
                    <div class="report-card">
                        <h3>压力测试情景</h3>
                        <table class="stress-test-table">
                            <thead>
                                <tr>
                                    <th>情景</th>
                                    <th>假设条件</th>
                                    <th>项目IRR</th>
                                    <th>最低DSCR</th>
                                </tr>
                            </thead>
                            <tbody id="stress_test_body">
                                <!-- 动态生成 -->
                            </tbody>
                        </table>
                    </div>
                    <div class="report-card">
                        <h3>风险评估矩阵</h3>
                        <div class="risk-matrix">
                            <div class="risk-item low">
                                <span class="risk-icon">✅</span>
                                <span class="risk-text">市场风险: 低</span>
                                <span class="risk-note">Tolling合同锁定</span>
                            </div>
                            <div class="risk-item low">
                                <span class="risk-icon">✅</span>
                                <span class="risk-text">技术风险: 低</span>
                                <span class="risk-note">成熟锂电技术</span>
                            </div>
                            <div class="risk-item medium">
                                <span class="risk-icon">⚠️</span>
                                <span class="risk-text">运营风险: 中</span>
                                <span class="risk-note">电池衰减管理</span>
                            </div>
                            <div class="risk-item low">
                                <span class="risk-icon">✅</span>
                                <span class="risk-text">政策风险: 低</span>
                                <span class="risk-note">德国能源转型支持</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 资产负债结构 -->
            <div class="report-section">
                <div class="section-title">
                    <span class="title-icon">📊</span>
                    <h2>六、财务结构分析 (Financial Structure)</h2>
                </div>
                <div class="report-grid">
                    <div class="report-card">
                        <h3>资产负债率趋势</h3>
                        <div class="chart-wrapper">
                            <canvas id="bankLeverageChart"></canvas>
                        </div>
                    </div>
                    <div class="report-card">
                        <h3>净资产收益率(ROE)趋势</h3>
                        <div class="chart-wrapper">
                            <canvas id="bankROEChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 结论与建议 -->
            <div class="report-section">
                <div class="section-title">
                    <span class="title-icon">✅</span>
                    <h2>七、结论与建议 (Conclusion)</h2>
                </div>
                <div class="conclusion-box">
                    <div class="conclusion-rating" id="conclusion_rating">
                        <span class="rating-icon">⭐</span>
                        <span class="rating-text">投资评级: <strong id="rpt_rating">-</strong></span>
                    </div>
                    <div class="conclusion-content">
                        <h4>项目优势:</h4>
                        <ul id="project_strengths">
                            <!-- 动态生成 -->
                        </ul>
                        <h4>关注事项:</h4>
                        <ul id="project_concerns">
                            <!-- 动态生成 -->
                        </ul>
                        <h4>融资建议:</h4>
                        <p id="financing_recommendation">-</p>
                    </div>
                </div>
            </div>

            <!-- 附录：详细财务预测表 -->
            <div class="report-section">
                <div class="section-title">
                    <span class="title-icon">📑</span>
                    <h2>附录：财务预测明细表 (Appendix)</h2>
                </div>
                <div class="appendix-tabs">
                    <button class="appendix-tab active" onclick="switchAppendix('cashflow_proj')">现金流预测</button>
                    <button class="appendix-tab" onclick="switchAppendix('income_proj')">损益预测</button>
                    <button class="appendix-tab" onclick="switchAppendix('balance_proj')">资产负债预测</button>
                </div>
                <div id="appendix_cashflow_proj" class="appendix-content active">
                    <div class="table-scroll">
                        <table class="bank-table" id="bank_cashflow_table">
                            <thead id="bank_cashflow_head">
                                <!-- 动态生成 -->
                            </thead>
                            <tbody id="bank_cashflow_body">
                                <!-- 动态生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="appendix_income_proj" class="appendix-content">
                    <div class="table-scroll">
                        <table class="bank-table" id="bank_income_table">
                            <thead id="bank_income_head">
                                <!-- 动态生成 -->
                            </thead>
                            <tbody id="bank_income_body">
                                <!-- 动态生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="appendix_balance_proj" class="appendix-content">
                    <div class="table-scroll">
                        <table class="bank-table" id="bank_balance_table">
                            <thead id="bank_balance_head">
                                <!-- 动态生成 -->
                            </thead>
                            <tbody id="bank_balance_body">
                                <!-- 动态生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 报告页脚 -->
            <div class="report-footer">
                <p>本报告由德国独立储能电站投资测算系统自动生成，仅供融资决策参考。</p>
                <p>This report is auto-generated for financing decision reference only.</p>
            </div>
        </section>
    </main>

    <!-- 帮助模态框 -->
    <div id="helpModal" class="modal" style="display: none;">
        <div class="modal-content help-modal-content">
            <div class="modal-header">
                <h2>📖 使用帮助</h2>
                <button class="modal-close" onclick="closeHelp()">&times;</button>
            </div>
            <div class="modal-body help-body">
                <div class="help-tabs">
                    <button class="help-tab active" onclick="switchHelpTab('quickstart')">快速开始</button>
                    <button class="help-tab" onclick="switchHelpTab('parameters')">参数设定</button>
                    <button class="help-tab" onclick="switchHelpTab('features')">功能说明</button>
                    <button class="help-tab" onclick="switchHelpTab('finance')">财务知识</button>
                    <button class="help-tab" onclick="switchHelpTab('tips')">使用技巧</button>
                </div>
                
                <div id="help-quickstart" class="help-tab-content active">
                    <h3>🚀 快速开始</h3>
                    <ol>
                        <li><strong>登录系统</strong>：使用您的用户名和密码登录系统</li>
                        <li><strong>设定参数</strong>：在"边界设定"标签页中设置项目基础参数
                            <ul>
                                <li>电站功率和容量</li>
                                <li>电池型号（选择后会自动填充衰减参数）</li>
                                <li>设备配置和价格</li>
                                <li>融资参数</li>
                            </ul>
                        </li>
                        <li><strong>设定OPEX</strong>：在"OPEX设定"标签页中设置年度运营成本</li>
                        <li><strong>设定收入</strong>：在"收入预测"标签页中设置收入来源和价格</li>
                        <li><strong>查看结果</strong>：点击"计算"按钮或修改参数后自动计算，查看财务指标和报表</li>
                    </ol>
                    <div class="help-note">
                        <strong>💡 提示：</strong>系统支持参数自动计算，修改参数后会在500毫秒后自动更新结果，无需手动点击计算按钮。
                    </div>
                </div>
                
                <div id="help-parameters" class="help-tab-content" style="display: none;">
                    <h3>⚙️ 参数设定说明</h3>
                    
                    <h4>1. 电站基础参数</h4>
                    <ul>
                        <li><strong>电站装机功率</strong>：储能系统的额定功率（MW）</li>
                        <li><strong>电站储能容量</strong>：储能系统的总容量（MWh）</li>
                        <li><strong>储能时长</strong>：自动计算（容量/功率），通常为2-4小时</li>
                        <li><strong>运营年限</strong>：项目运营周期，通常为15-20年</li>
                        <li><strong>首年电池可用容量</strong>：新电池的初始可用容量百分比</li>
                    </ul>
                    
                    <h4>2. 容量衰减设定</h4>
                    <ul>
                        <li><strong>衰减模式</strong>：
                            <ul>
                                <li>线性衰减：固定年衰减率，适用于大多数LFP电池</li>
                                <li>非线性衰减：前期衰减快，后期衰减慢</li>
                                <li>循环次数衰减：基于循环次数计算容量损失</li>
                            </ul>
                        </li>
                        <li><strong>自动填充</strong>：选择电池型号后，系统会自动填充该型号的默认衰减参数</li>
                    </ul>
                    
                    <h4>3. 电池系统</h4>
                    <ul>
                        <li><strong>电池柜型号</strong>：选择电池厂家和型号，系统会自动填充价格和衰减参数</li>
                        <li><strong>电池单价</strong>：每MWh的电池价格（万EUR），会根据选择的型号自动填充</li>
                        <li><strong>电池柜数量</strong>：系统根据总容量和单柜容量自动计算</li>
                    </ul>
                    
                    <h4>4. 融资参数</h4>
                    <ul>
                        <li><strong>资本金比例</strong>：德国项目通常为25-30%</li>
                        <li><strong>贷款年限</strong>：通常为10-15年</li>
                        <li><strong>贷款利率</strong>：2025年欧洲市场基准利率约4-5%</li>
                        <li><strong>还款方式</strong>：等额本金或等额本息</li>
                    </ul>
                    
                    <h4>5. CAPEX设定</h4>
                    <ul>
                        <li>系统会自动根据设备配置计算各项CAPEX</li>
                        <li>包括：设备费、电网接入、土地基建、安装施工、保险、开发费用等</li>
                        <li>所有参数修改后，CAPEX明细表会自动更新</li>
                    </ul>
                </div>
                
                <div id="help-features" class="help-tab-content" style="display: none;">
                    <h3>✨ 功能说明</h3>
                    
                    <h4>1. 自动计算功能</h4>
                    <ul>
                        <li>修改任何参数后，系统会在500毫秒后自动重新计算</li>
                        <li>无需手动点击"计算"按钮</li>
                        <li>所有表格和图表会自动更新</li>
                    </ul>
                    
                    <h4>2. 数据格式化</h4>
                    <ul>
                        <li>所有数值使用德国千分位格式显示（1.234.567,89）</li>
                        <li>金额单位：万EUR</li>
                        <li>百分比自动格式化</li>
                    </ul>
                    
                    <h4>3. 模型保存与导入</h4>
                    <ul>
                        <li><strong>保存模型</strong>：点击"保存"按钮，将当前所有参数保存为JSON文件</li>
                        <li><strong>导入模型</strong>：点击"导入"按钮，加载之前保存的模型参数</li>
                        <li>方便不同场景的参数对比和方案管理</li>
                    </ul>
                    
                    <h4>4. 报表导出</h4>
                    <ul>
                        <li><strong>导出报表</strong>：生成完整的财务分析报告（PDF格式）</li>
                        <li>包含：项目概览、CAPEX明细、财务指标、财务报表等</li>
                        <li>适用于向投资方、银行等机构展示</li>
                    </ul>
                    
                    <h4>5. 敏感性分析</h4>
                    <ul>
                        <li>分析关键参数变化对财务指标的影响</li>
                        <li>支持多参数同时变化分析</li>
                        <li>生成敏感性分析图表</li>
                    </ul>
                    
                    <h4>6. 融资报告</h4>
                    <ul>
                        <li>生成银行融资所需的财务报告</li>
                        <li>包含：项目概览、财务指标、现金流预测、偿债能力分析等</li>
                    </ul>
                </div>
                
                <div id="help-finance" class="help-tab-content" style="display: none;">
                    <h3>📚 财务知识专栏</h3>
                    
                    <div class="finance-section">
                        <h4>一、三大财务报表基础</h4>
                        
                        <div class="finance-concept">
                            <h5>1. 利润表（Income Statement）</h5>
                            <p><strong>通俗理解：</strong>利润表就像企业的"成绩单"，告诉你一年下来赚了多少钱，花了多少钱，最后剩多少。</p>
                            <div class="formula-box">
                                <strong>核心公式：</strong>
                                <div class="formula">
                                    净利润 = 营业收入 - 营业成本 - 运营费用 - 折旧摊销 - 利息 - 所得税
                                </div>
                            </div>
                            <div class="finance-diagram">
                                <div class="diagram-title">利润表结构图：</div>
                                <div class="diagram-content">
                                    <div class="diagram-item" style="background: var(--primary-glow); padding: 10px; margin: 5px 0; border-left: 3px solid var(--primary);">
                                        <strong>营业收入</strong> (最上面，所有收入的总和)
                                    </div>
                                    <div style="text-align: center; padding: 5px;">-</div>
                                    <div class="diagram-item" style="background: var(--bg-input); padding: 10px; margin: 5px 0;">
                                        <strong>营业成本</strong> (直接成本，如设备维护)
                                    </div>
                                    <div style="text-align: center; padding: 5px;">=</div>
                                    <div class="diagram-item" style="background: var(--primary-glow); padding: 10px; margin: 5px 0; border-left: 3px solid var(--primary);">
                                        <strong>毛利润</strong>
                                    </div>
                                    <div style="text-align: center; padding: 5px;">-</div>
                                    <div class="diagram-item" style="background: var(--bg-input); padding: 10px; margin: 5px 0;">
                                        <strong>运营费用</strong> (OPEX：人工、保险、土地租赁等)
                                    </div>
                                    <div style="text-align: center; padding: 5px;">-</div>
                                    <div class="diagram-item" style="background: var(--bg-input); padding: 10px; margin: 5px 0;">
                                        <strong>折旧摊销</strong> (设备价值逐年减少)
                                    </div>
                                    <div style="text-align: center; padding: 5px;">=</div>
                                    <div class="diagram-item" style="background: var(--primary-glow); padding: 10px; margin: 5px 0; border-left: 3px solid var(--primary);">
                                        <strong>EBITDA</strong> (息税折旧摊销前利润)
                                    </div>
                                    <div style="text-align: center; padding: 5px;">-</div>
                                    <div class="diagram-item" style="background: var(--bg-input); padding: 10px; margin: 5px 0;">
                                        <strong>利息</strong> (银行贷款利息)
                                    </div>
                                    <div style="text-align: center; padding: 5px;">=</div>
                                    <div class="diagram-item" style="background: var(--primary-glow); padding: 10px; margin: 5px 0; border-left: 3px solid var(--primary);">
                                        <strong>税前利润 (EBT)</strong>
                                    </div>
                                    <div style="text-align: center; padding: 5px;">-</div>
                                    <div class="diagram-item" style="background: var(--bg-input); padding: 10px; margin: 5px 0;">
                                        <strong>所得税</strong>
                                    </div>
                                    <div style="text-align: center; padding: 5px;">=</div>
                                    <div class="diagram-item" style="background: var(--success); padding: 10px; margin: 5px 0; border-left: 3px solid var(--success); font-weight: bold;">
                                        <strong>净利润</strong> (最终赚到的钱)
                                    </div>
                                </div>
                            </div>
                            <div class="help-note">
                                <strong>💡 关键理解：</strong>EBITDA是衡量项目运营能力的重要指标，因为它排除了折旧、利息和税收的影响，更能反映项目的真实盈利能力。
                            </div>
                        </div>
                        
                        <div class="finance-concept">
                            <h5>2. 现金流量表（Cash Flow Statement）</h5>
                            <p><strong>通俗理解：</strong>现金流量表就像企业的"银行流水"，记录现金的流入和流出，告诉你实际收到和花出去的钱。</p>
                            <div class="formula-box">
                                <strong>核心公式：</strong>
                                <div class="formula">
                                    净现金流 = 经营活动现金流 + 投资活动现金流 + 筹资活动现金流
                                </div>
                            </div>
                            <div class="finance-diagram">
                                <div class="diagram-title">现金流量表三大活动：</div>
                                <div class="diagram-content">
                                    <div class="diagram-item" style="background: var(--primary-glow); padding: 15px; margin: 10px 0; border-left: 4px solid var(--primary);">
                                        <strong>经营活动现金流</strong><br>
                                        <small>来源：营业收入 - 运营成本</small><br>
                                        <small>说明：项目日常运营产生的现金</small>
                                    </div>
                                    <div class="diagram-item" style="background: var(--accent); padding: 15px; margin: 10px 0; border-left: 4px solid var(--accent-light);">
                                        <strong>投资活动现金流</strong><br>
                                        <small>来源：建设期投资（负值）、残值回收（正值）</small><br>
                                        <small>说明：购买设备、建设电站等一次性大额支出</small>
                                    </div>
                                    <div class="diagram-item" style="background: var(--warning); padding: 15px; margin: 10px 0; border-left: 4px solid var(--warning);">
                                        <strong>筹资活动现金流</strong><br>
                                        <small>来源：股东投资（正值）、银行贷款（正值）、还本付息（负值）</small><br>
                                        <small>说明：如何筹集资金来支持项目</small>
                                    </div>
                                </div>
                            </div>
                            <div class="help-note">
                                <strong>💡 关键理解：</strong>利润表显示"赚了多少钱"，现金流量表显示"实际收到多少钱"。两者可能不同，因为折旧不是现金支出，但会影响利润。
                            </div>
                        </div>
                        
                        <div class="finance-concept">
                            <h5>3. 资产负债表（Balance Sheet）</h5>
                            <p><strong>通俗理解：</strong>资产负债表就像企业的"家底清单"，左边列出你拥有什么（资产），右边列出你欠别人什么（负债）和你自己的钱（权益）。</p>
                            <div class="formula-box">
                                <strong>核心公式（会计恒等式）：</strong>
                                <div class="formula">
                                    资产 = 负债 + 所有者权益
                                </div>
                            </div>
                            <div class="finance-diagram">
                                <div class="diagram-title">资产负债表结构：</div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                                    <div>
                                        <div style="background: var(--bg-input); padding: 10px; font-weight: bold; margin-bottom: 10px;">资产（左边）</div>
                                        <div class="diagram-item" style="background: var(--primary-glow); padding: 10px; margin: 5px 0;">
                                            <strong>货币资金</strong><br>
                                            <small>银行账户里的现金</small>
                                        </div>
                                        <div class="diagram-item" style="background: var(--primary-glow); padding: 10px; margin: 5px 0;">
                                            <strong>固定资产净值</strong><br>
                                            <small>设备原值 - 累计折旧</small>
                                        </div>
                                        <div class="diagram-item" style="background: var(--primary-glow); padding: 10px; margin: 5px 0;">
                                            <strong>无形资产</strong><br>
                                            <small>土地、开发费用等</small>
                                        </div>
                                        <div style="background: var(--success); padding: 10px; margin-top: 10px; font-weight: bold;">
                                            <strong>总资产</strong>
                                        </div>
                                    </div>
                                    <div>
                                        <div style="background: var(--bg-input); padding: 10px; font-weight: bold; margin-bottom: 10px;">负债 + 权益（右边）</div>
                                        <div class="diagram-item" style="background: var(--accent); padding: 10px; margin: 5px 0;">
                                            <strong>长期借款</strong><br>
                                            <small>银行贷款余额</small>
                                        </div>
                                        <div class="diagram-item" style="background: var(--primary-glow); padding: 10px; margin: 5px 0;">
                                            <strong>实收资本</strong><br>
                                            <small>股东投入的钱</small>
                                        </div>
                                        <div class="diagram-item" style="background: var(--primary-glow); padding: 10px; margin: 5px 0;">
                                            <strong>未分配利润</strong><br>
                                            <small>历年累计的净利润</small>
                                        </div>
                                        <div style="background: var(--success); padding: 10px; margin-top: 10px; font-weight: bold;">
                                            <strong>负债 + 权益</strong>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="help-note">
                                <strong>💡 关键理解：</strong>资产负债表必须平衡！左边（资产）永远等于右边（负债+权益）。如果不等，说明计算有误。
                            </div>
                        </div>
                    </div>
                    
                    <div class="finance-section">
                        <h4>二、核心财务指标详解</h4>
                        
                        <div class="finance-concept">
                            <h5>1. IRR - 内部收益率（Internal Rate of Return）</h5>
                            <p><strong>通俗理解：</strong>IRR就是"如果这个项目是一个银行账户，年利率是多少？"它告诉你投资这个项目的年化收益率。</p>
                            <div class="formula-box">
                                <strong>计算公式：</strong>
                                <div class="formula">
                                    NPV = Σ(现金流 / (1 + IRR)^年数) = 0
                                </div>
                                <small>通过试错法求解IRR，使得净现值为0</small>
                            </div>
                            <div class="finance-diagram">
                                <div class="diagram-title">IRR计算示意图：</div>
                                <div class="diagram-content" style="padding: 15px; background: var(--bg-input); border-radius: 8px; margin: 10px 0;">
                                    <div style="text-align: center; margin-bottom: 15px;">
                                        <div style="display: inline-block; padding: 10px 20px; background: var(--accent); border-radius: 5px; margin: 5px;">
                                            第0年：-1000万（投资）
                                        </div>
                                        <div style="display: inline-block; padding: 10px 20px; background: var(--primary); border-radius: 5px; margin: 5px;">
                                            第1年：+200万
                                        </div>
                                        <div style="display: inline-block; padding: 10px 20px; background: var(--primary); border-radius: 5px; margin: 5px;">
                                            第2年：+300万
                                        </div>
                                        <div style="display: inline-block; padding: 10px 20px; background: var(--primary); border-radius: 5px; margin: 5px;">
                                            ...持续20年
                                        </div>
                                    </div>
                                    <div style="text-align: center; padding: 10px; background: var(--success); border-radius: 5px;">
                                        <strong>IRR = 使所有现金流折现后总和为0的利率</strong>
                                    </div>
                                </div>
                            </div>
                            <div class="help-note">
                                <strong>💡 如何解读：</strong>
                                <ul style="margin-top: 10px;">
                                    <li>IRR > 8%（市场基准利率）：项目有吸引力</li>
                                    <li>IRR > 12%：非常好的投资项目</li>
                                    <li>IRR < 8%：可能不值得投资</li>
                                    <li>全投资IRR：考虑所有资金（自有+贷款）的收益率</li>
                                    <li>资本金IRR：只考虑自有资金的收益率（通常更高）</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="finance-concept">
                            <h5>2. NPV - 净现值（Net Present Value）</h5>
                            <p><strong>通俗理解：</strong>NPV就是把未来所有的钱，按照利率"折现"到今天，看看值多少钱。如果NPV是正数，说明项目值得投资。</p>
                            <div class="formula-box">
                                <strong>计算公式：</strong>
                                <div class="formula">
                                    NPV = Σ(现金流 / (1 + 折现率)^年数)
                                </div>
                                <small>折现率通常取8%（市场基准利率）</small>
                            </div>
                            <div class="finance-diagram">
                                <div class="diagram-title">NPV计算示例：</div>
                                <div class="diagram-content" style="padding: 15px; background: var(--bg-input); border-radius: 8px; margin: 10px 0;">
                                    <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                                        <thead>
                                            <tr style="background: var(--bg-card);">
                                                <th style="padding: 8px; border: 1px solid var(--border-color);">年份</th>
                                                <th style="padding: 8px; border: 1px solid var(--border-color);">现金流</th>
                                                <th style="padding: 8px; border: 1px solid var(--border-color);">折现系数(8%)</th>
                                                <th style="padding: 8px; border: 1px solid var(--border-color);">现值</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td style="padding: 8px; border: 1px solid var(--border-color); text-align: center;">0</td>
                                                <td style="padding: 8px; border: 1px solid var(--border-color); text-align: right; color: var(--accent);">-10,000</td>
                                                <td style="padding: 8px; border: 1px solid var(--border-color); text-align: center;">1.000</td>
                                                <td style="padding: 8px; border: 1px solid var(--border-color); text-align: right; color: var(--accent);">-10,000</td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 8px; border: 1px solid var(--border-color); text-align: center;">1</td>
                                                <td style="padding: 8px; border: 1px solid var(--border-color); text-align: right; color: var(--primary);">+2,000</td>
                                                <td style="padding: 8px; border: 1px solid var(--border-color); text-align: center;">0.926</td>
                                                <td style="padding: 8px; border: 1px solid var(--border-color); text-align: right; color: var(--primary);">+1,852</td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 8px; border: 1px solid var(--border-color); text-align: center;">2</td>
                                                <td style="padding: 8px; border: 1px solid var(--border-color); text-align: right; color: var(--primary);">+3,000</td>
                                                <td style="padding: 8px; border: 1px solid var(--border-color); text-align: center;">0.857</td>
                                                <td style="padding: 8px; border: 1px solid var(--border-color); text-align: right; color: var(--primary);">+2,571</td>
                                            </tr>
                                            <tr style="background: var(--success); font-weight: bold;">
                                                <td style="padding: 8px; border: 1px solid var(--border-color);" colspan="3">NPV合计</td>
                                                <td style="padding: 8px; border: 1px solid var(--border-color); text-align: right;">+5,423</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="help-note">
                                <strong>💡 如何解读：</strong>
                                <ul style="margin-top: 10px;">
                                    <li>NPV > 0：项目值得投资，能创造价值</li>
                                    <li>NPV = 0：项目刚好保本（此时折现率 = IRR）</li>
                                    <li>NPV < 0：项目不值得投资</li>
                                    <li>NPV越大，项目越有吸引力</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="finance-concept">
                            <h5>3. 投资回收期（Payback Period）</h5>
                            <p><strong>通俗理解：</strong>回收期就是"多久能回本？"告诉你需要多少年才能收回初始投资。</p>
                            <div class="formula-box">
                                <strong>静态回收期：</strong>
                                <div class="formula">
                                    累计现金流首次为正的年份
                                </div>
                                <strong>动态回收期：</strong>
                                <div class="formula">
                                    累计折现现金流首次为正的年份
                                </div>
                            </div>
                            <div class="finance-diagram">
                                <div class="diagram-title">回收期示意图：</div>
                                <div class="diagram-content" style="padding: 15px; background: var(--bg-input); border-radius: 8px; margin: 10px 0;">
                                    <div style="display: flex; align-items: center; justify-content: space-around; margin: 15px 0;">
                                        <div style="text-align: center;">
                                            <div style="padding: 15px; background: var(--accent); border-radius: 5px; margin-bottom: 5px;">
                                                <strong>第0年</strong><br>投资-1000万
                                            </div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="padding: 15px; background: var(--primary-glow); border-radius: 5px; margin-bottom: 5px;">
                                                <strong>第1-7年</strong><br>累计回本中
                                            </div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="padding: 15px; background: var(--success); border-radius: 5px; margin-bottom: 5px;">
                                                <strong>第8年</strong><br>✅ 完全回本
                                            </div>
                                        </div>
                                    </div>
                                    <div style="text-align: center; padding: 10px; background: var(--primary-glow); border-radius: 5px;">
                                        <strong>回收期 = 8年</strong>
                                    </div>
                                </div>
                            </div>
                            <div class="help-note">
                                <strong>💡 如何解读：</strong>
                                <ul style="margin-top: 10px;">
                                    <li>回收期越短越好，通常希望 < 10年</li>
                                    <li>静态回收期：不考虑资金时间价值（简单但不够准确）</li>
                                    <li>动态回收期：考虑资金时间价值（更准确，通常比静态回收期长）</li>
                                    <li>全投资回收期：考虑所有资金（自有+贷款）</li>
                                    <li>资本金回收期：只考虑自有资金（通常更短）</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="finance-concept">
                            <h5>4. ROI - 投资回报率（Return on Investment）</h5>
                            <p><strong>通俗理解：</strong>ROI就是"平均每年能赚多少钱，占投资的百分之几？"</p>
                            <div class="formula-box">
                                <strong>计算公式：</strong>
                                <div class="formula">
                                    ROI = (平均年净利润 / 总投资) × 100%
                                </div>
                            </div>
                            <div class="help-note">
                                <strong>💡 如何解读：</strong>
                                <ul style="margin-top: 10px;">
                                    <li>ROI > 5%：项目有基本盈利能力</li>
                                    <li>ROI > 8%：项目盈利能力良好</li>
                                    <li>ROI < 5%：项目盈利能力较弱</li>
                                    <li>ROI是简单直观的指标，但没有考虑资金时间价值</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="finance-concept">
                            <h5>5. ROE - 净资产收益率（Return on Equity）</h5>
                            <p><strong>通俗理解：</strong>ROE就是"股东投入的钱，每年能赚回百分之几？"</p>
                            <div class="formula-box">
                                <strong>计算公式：</strong>
                                <div class="formula">
                                    ROE = (净利润 / 净资产) × 100%
                                </div>
                                <small>通常计算第3年的ROE，因为项目已稳定运营</small>
                            </div>
                            <div class="help-note">
                                <strong>💡 如何解读：</strong>
                                <ul style="margin-top: 10px;">
                                    <li>ROE > 10%：股东回报良好</li>
                                    <li>ROE > 15%：股东回报优秀</li>
                                    <li>ROE考虑了财务杠杆（贷款）的影响，比ROI更能反映股东实际收益</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="finance-concept">
                            <h5>6. DSCR - 偿债覆盖率（Debt Service Coverage Ratio）</h5>
                            <p><strong>通俗理解：</strong>DSCR就是"每年赚的钱够不够还贷款？"如果DSCR=1.5，说明赚的钱是还贷金额的1.5倍，很安全。</p>
                            <div class="formula-box">
                                <strong>计算公式：</strong>
                                <div class="formula">
                                    DSCR = EBITDA / 债务本息偿还额
                                </div>
                                <small>通常计算运营期平均值</small>
                            </div>
                            <div class="finance-diagram">
                                <div class="diagram-title">DSCR示意图：</div>
                                <div class="diagram-content" style="padding: 15px; background: var(--bg-input); border-radius: 8px; margin: 10px 0;">
                                    <div style="text-align: center; margin: 15px 0;">
                                        <div style="display: inline-block; padding: 15px 25px; background: var(--primary); border-radius: 5px; margin: 5px;">
                                            <strong>EBITDA</strong><br>
                                            <span style="font-size: 24px;">1,500万</span>
                                        </div>
                                        <div style="display: inline-block; padding: 15px 25px; font-size: 24px; margin: 5px;">÷</div>
                                        <div style="display: inline-block; padding: 15px 25px; background: var(--accent); border-radius: 5px; margin: 5px;">
                                            <strong>还本付息</strong><br>
                                            <span style="font-size: 24px;">1,000万</span>
                                        </div>
                                        <div style="display: inline-block; padding: 15px 25px; font-size: 24px; margin: 5px;">=</div>
                                        <div style="display: inline-block; padding: 15px 25px; background: var(--success); border-radius: 5px; margin: 5px;">
                                            <strong>DSCR</strong><br>
                                            <span style="font-size: 24px;">1.5</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="help-note">
                                <strong>💡 如何解读：</strong>
                                <ul style="margin-top: 10px;">
                                    <li>DSCR > 1.2：偿债能力充足，银行通常要求此标准</li>
                                    <li>DSCR = 1.0：刚好够还贷，风险较高</li>
                                    <li>DSCR < 1.0：不够还贷，项目有风险</li>
                                    <li>DSCR是银行评估项目贷款风险的重要指标</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="finance-section">
                        <h4>三、重要财务概念</h4>
                        
                        <div class="finance-concept">
                            <h5>1. CAPEX vs OPEX</h5>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
                                <div style="background: var(--bg-input); padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary);">
                                    <strong style="color: var(--primary);">CAPEX（资本性支出）</strong>
                                    <ul style="margin-top: 10px; font-size: 14px;">
                                        <li>一次性大额投资</li>
                                        <li>如：设备采购、建设费用</li>
                                        <li>通过折旧逐年计入成本</li>
                                        <li>影响资产负债表</li>
                                    </ul>
                                </div>
                                <div style="background: var(--bg-input); padding: 15px; border-radius: 8px; border-left: 4px solid var(--accent);">
                                    <strong style="color: var(--accent);">OPEX（运营性支出）</strong>
                                    <ul style="margin-top: 10px; font-size: 14px;">
                                        <li>年度运营成本</li>
                                        <li>如：人工、保险、维护</li>
                                        <li>直接计入当年成本</li>
                                        <li>影响利润表</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="finance-concept">
                            <h5>2. 折旧（Depreciation）</h5>
                            <p><strong>通俗理解：</strong>设备会老化，价值会减少。折旧就是把设备成本分摊到使用年限中，每年"消耗"一部分价值。</p>
                            <div class="formula-box">
                                <strong>直线法折旧公式：</strong>
                                <div class="formula">
                                    年折旧额 = (资产原值 - 残值) / 折旧年限
                                </div>
                            </div>
                            <div class="help-note">
                                <strong>💡 关键理解：</strong>折旧不是现金支出，但会减少利润。它把一次性投资（CAPEX）分摊到多年，让利润表更合理。
                            </div>
                        </div>
                        
                        <div class="finance-concept">
                            <h5>3. 折现（Discounting）</h5>
                            <p><strong>通俗理解：</strong>今天的100元比明年的100元更值钱（因为可以存银行赚利息）。折现就是把未来的钱换算成今天的价值。</p>
                            <div class="formula-box">
                                <strong>折现公式：</strong>
                                <div class="formula">
                                    现值 = 未来值 / (1 + 折现率)^年数
                                </div>
                                <small>折现率通常取8%（市场基准利率）</small>
                            </div>
                            <div class="finance-diagram">
                                <div class="diagram-title">折现示例：</div>
                                <div class="diagram-content" style="padding: 15px; background: var(--bg-input); border-radius: 8px; margin: 10px 0;">
                                    <div style="text-align: center;">
                                        <div style="display: inline-block; padding: 10px 20px; background: var(--primary); border-radius: 5px; margin: 5px;">
                                            10年后的100万
                                        </div>
                                        <div style="display: inline-block; padding: 10px 20px; font-size: 20px; margin: 5px;">→</div>
                                        <div style="display: inline-block; padding: 10px 20px; background: var(--success); border-radius: 5px; margin: 5px;">
                                            今天的46.3万
                                        </div>
                                        <div style="margin-top: 10px; font-size: 12px; color: var(--text-secondary);">
                                            (按8%折现率计算)
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="finance-section">
                        <h4>四、如何解读财务指标</h4>
                        <div class="help-note" style="background: var(--primary-glow); border-left: 4px solid var(--primary);">
                            <strong>📊 综合评估项目：</strong>
                            <ol style="margin-top: 10px;">
                                <li><strong>盈利能力：</strong>看IRR、NPV、ROI、ROE，越高越好</li>
                                <li><strong>回本速度：</strong>看回收期，越短越好（通常<10年）</li>
                                <li><strong>偿债能力：</strong>看DSCR，必须>1.2（银行要求）</li>
                                <li><strong>现金流：</strong>看现金流量表，确保每年都有正现金流</li>
                                <li><strong>风险控制：</strong>使用敏感性分析，看哪些参数变化影响最大</li>
                            </ol>
                        </div>
                    </div>
                </div>
                
                <div id="help-tips" class="help-tab-content" style="display: none;">
                    <h3>💡 使用技巧</h3>
                    
                    <h4>1. 参数设定技巧</h4>
                    <ul>
                        <li><strong>使用默认值</strong>：系统已预设德国市场主流参数，可直接使用</li>
                        <li><strong>电池型号选择</strong>：选择电池型号后，价格和衰减参数会自动填充，无需手动输入</li>
                        <li><strong>参数提示</strong>：每个输入框都有提示信息，显示市场参考范围</li>
                    </ul>
                    
                    <h4>2. 财务分析技巧</h4>
                    <ul>
                        <li><strong>关注关键指标</strong>：IRR、NPV、投资回收期、DSCR、ROI等</li>
                        <li><strong>对比不同方案</strong>：使用保存/导入功能，对比不同参数配置的财务表现</li>
                        <li><strong>敏感性分析</strong>：识别对项目盈利能力影响最大的参数</li>
                    </ul>
                    
                    <h4>3. 常见问题</h4>
                    <ul>
                        <li><strong>Q: 为什么CAPEX明细表没有更新？</strong><br>
                            A: 系统会在参数修改后500毫秒自动更新，请稍等片刻。如果仍未更新，可手动点击"计算"按钮。</li>
                        <li><strong>Q: 如何重置所有参数？</strong><br>
                            A: 刷新页面即可恢复默认参数，或导入之前保存的模型文件。</li>
                        <li><strong>Q: 电池衰减参数如何设定？</strong><br>
                            A: 选择电池型号后，系统会自动填充该型号的默认衰减参数。您也可以根据实际情况手动调整。</li>
                        <li><strong>Q: 如何导出完整的财务报告？</strong><br>
                            A: 点击"导出"按钮，系统会生成包含所有财务数据的PDF报告。</li>
                    </ul>
                    
                    <h4>4. 最佳实践</h4>
                    <ul>
                        <li>先使用默认参数进行初步测算，了解项目基本财务表现</li>
                        <li>根据实际项目情况，逐步调整关键参数</li>
                        <li>使用敏感性分析，识别项目风险点</li>
                        <li>保存多个方案，便于对比和决策</li>
                        <li>定期更新市场参数（如电价、设备价格等）</li>
                    </ul>
                    
                    <h4>5. 注意事项</h4>
                    <ul>
                        <li>财务模型仅供参考，实际决策需结合市场调研和专家意见</li>
                        <li>德国市场参数会随时间变化，建议定期更新</li>
                        <li>不同地区的政策、电价等可能有差异，需根据实际情况调整</li>
                        <li>电池衰减参数基于行业平均水平，实际衰减可能因使用条件而异</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="closeHelp()">关闭</button>
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <footer class="footer">
        <p>德国独立储能电站投资测算系统 v1.0 | 财务模型仅供参考，请结合实际情况决策</p>
    </footer>

    <script src="financial-model.js"></script>
    
    <!-- 语言切换逻辑 -->
    <script>
        // 语言映射表（和登录页、注册页保持一致）
        const langMap = {
            zh: {
                // 导航栏
                index: {
                    brandText: "德国独立储能电站投资测算系统",
                    navParameters: "边界设定",
                    navOpex: "OPEX设定",
                    navRevenue: "收入预测",
                    navIndicators: "财务指标",
                    navStatements: "财务报表",
                    navSensitivity: "敏感性分析",
                    navBankReport: "融资报告",
                    helpBtn: "帮助",
                    importBtn: "导入",
                    saveBtn: "保存",
                    exportReportBtn: "导出",
                    exportExcelBtn: "Excel",
                    calculateBtn: "计算",
                    logoutBtn: "退出"
                }
            },
            
            // 边界设定界面
            parameters: {
                sectionTitle: "📊 项目边界条件设定",
                sectionDesc: "设置储能电站的基础参数和设备配置",
                basicParamsCard: "电站基础参数",
                powerLabel: "电站装机功率",
                powerHint: "德国大型储能项目典型规模",
                capacityLabel: "电站储能容量",
                capacityHint: "2小时储能配置",
                durationLabel: "储能时长",
                operationYearsLabel: "电站运营年限",
                operationYearsHint: "行业标准运营周期",
                initialCapacityLabel: "首年电池可用容量",
                
                degradationCard: "容量衰减设定",
                degradationModeLabel: "衰减模式",
                linearDegradation: "线性衰减（固定年衰减率）",
                nonlinearDegradation: "非线性衰减（前期快后期慢）",
                cycleBasedDegradation: "循环次数衰减",
                degradationModeHint: "根据电池特性选择衰减模式",
                degradationRateLabel: "年电池容量衰减率",
                degradationRateHint: "线性衰减模式：固定年衰减率",
                firstYearDegradationLabel: "首年衰减率",
                firstYearDegradationHint: "非线性衰减：首年衰减率（通常较高）",
                annualDecreaseLabel: "年衰减率递减幅度",
                annualDecreaseHint: "非线性衰减：每年衰减率递减幅度",
                cyclesPerDegradationLabel: "每1000次循环衰减率",
                cyclesPerDegradationHint: "循环次数衰减：每1000次循环的容量损失",
                annualCyclesLabel: "年运行循环次数",
                annualCyclesHint: "用于循环次数衰减模式计算",
                capacityThresholdLabel: "容量保持率阈值",
                capacityThresholdHint: "低于此阈值建议更换电池"
            }
        },
            en: {
                // 导航栏
                index: {
                    brandText: "German Independent Energy Storage Power Plant Investment Calculation System",
                    navParameters: "Boundary Settings",
                    navOpex: "OPEX Settings",
                    navRevenue: "Revenue Forecast",
                    navIndicators: "Financial Indicators",
                    navStatements: "Financial Statements",
                    navSensitivity: "Sensitivity Analysis",
                    navBankReport: "Financing Report",
                    helpBtn: "Help",
                    importBtn: "Import",
                    saveBtn: "Save",
                    exportReportBtn: "Export",
                    exportExcelBtn: "Excel",
                    calculateBtn: "Calculate",
                    logoutBtn: "Logout",
                    
                    // 边界设定界面
                    parameters: {
                        sectionTitle: "📊 Project Boundary Conditions",
                        sectionDesc: "Set basic parameters and equipment configuration for the energy storage power plant",
                        basicParamsCard: "Basic Power Plant Parameters",
                        powerLabel: "Installed Power Capacity",
                        powerHint: "Typical scale for large energy storage projects in Germany",
                        capacityLabel: "Energy Storage Capacity",
                        capacityHint: "2-hour storage configuration",
                        durationLabel: "Storage Duration",
                        operationYearsLabel: "Operation Years",
                        operationYearsHint: "Industry standard operation cycle",
                        initialCapacityLabel: "Initial Battery Available Capacity",
                        
                        degradationCard: "Capacity Degradation Settings",
                        degradationModeLabel: "Degradation Mode",
                        linearDegradation: "Linear Degradation (Fixed Annual Rate)",
                        nonlinearDegradation: "Nonlinear Degradation (Fast at First, Slow Later)",
                        cycleBasedDegradation: "Cycle-Based Degradation",
                        degradationModeHint: "Select degradation mode based on battery characteristics",
                        degradationRateLabel: "Annual Battery Capacity Degradation Rate",
                        degradationRateHint: "Linear degradation mode: fixed annual degradation rate",
                        firstYearDegradationLabel: "First Year Degradation Rate",
                        firstYearDegradationHint: "Nonlinear degradation: first year degradation rate (usually higher)",
                        annualDecreaseLabel: "Annual Decrease in Degradation Rate",
                        annualDecreaseHint: "Nonlinear degradation: annual decrease in degradation rate",
                        cyclesPerDegradationLabel: "Degradation Rate per 1000 Cycles",
                        cyclesPerDegradationHint: "Cycle-based degradation: capacity loss per 1000 cycles",
                        annualCyclesLabel: "Annual Operation Cycles",
                        annualCyclesHint: "Used for cycle-based degradation mode calculation",
                        capacityThresholdLabel: "Capacity Retention Threshold",
                        capacityThresholdHint: "Battery replacement recommended below this threshold"
                    }
                }
            },
            de: {
                // 导航栏
                index: {
                    brandText: "Deutsches unabhängiges Energiespeicher-Kraftwerk-Investitionsberechnungssystem",
                    navParameters: "Grenzwerteinstellungen",
                    navOpex: "OPEX-Einstellungen",
                    navRevenue: "Einnahmenprognose",
                    navIndicators: "Finanzindikatoren",
                    navStatements: "Finanzberichte",
                    navSensitivity: "Sensitivitätsanalyse",
                    navBankReport: "Finanzierungsbericht",
                    helpBtn: "Hilfe",
                    importBtn: "Importieren",
                    saveBtn: "Speichern",
                    exportReportBtn: "Exportieren",
                    exportExcelBtn: "Excel",
                    calculateBtn: "Berechnen",
                    logoutBtn: "Abmelden",
                    
                    // 边界设定界面
                    parameters: {
                        sectionTitle: "📊 Projektgrenzbedingungseinstellungen",
                        sectionDesc: "Stellen Sie die Grundparameter und die Gerätekonfiguration des Energiespeicher-Kraftwerks ein",
                        basicParamsCard: "Grundlegende Kraftwerksparameter",
                        powerLabel: "Installierte Leistung",
                        powerHint: "Typische Größe für große Energiespeicherprojekte in Deutschland",
                        capacityLabel: "Energiespeicherkapazität",
                        capacityHint: "2-Stunden-Speicher-Konfiguration",
                        durationLabel: "Speicherdauer",
                        operationYearsLabel: "Betriebsjahre",
                        operationYearsHint: "Branchenstandardbetriebszyklus",
                        initialCapacityLabel: "Erstjährige verfügbare Batteriekapazität",
                        
                        degradationCard: "Kapazitätsabbaueinstellungen",
                        degradationModeLabel: "Abbaumodus",
                        linearDegradation: "Lineare Degradation (feste jährliche Rate)",
                        nonlinearDegradation: "Nichtlineare Degradation (zuerst schnell, später langsam)",
                        cycleBasedDegradation: "Zyklusbasierte Degradation",
                        degradationModeHint: "Wählen Sie den Abbaumodus basierend auf den Batterieeigenschaften",
                        degradationRateLabel: "Jährliche Batteriekapazitätsabbaurate",
                        degradationRateHint: "Linearer Abbaumodus: feste jährliche Abbaurate",
                        firstYearDegradationLabel: "Erstjährige Abbaurate",
                        firstYearDegradationHint: "Nichtlineare Degradation: Erstjährige Abbaurate (normalerweise höher)",
                        annualDecreaseLabel: "Jährliche Abnahme der Abbaurate",
                        annualDecreaseHint: "Nichtlineare Degradation: jährliche Abnahme der Abbaurate",
                        cyclesPerDegradationLabel: "Abbaurate pro 1000 Zyklen",
                        cyclesPerDegradationHint: "Zyklusbasierte Degradation: Kapazitätsverlust pro 1000 Zyklen",
                        annualCyclesLabel: "Jährliche Betriebszyklen",
                        annualCyclesHint: "Verwendet für die zyklusbasierte Abbaumodusberechnung",
                        capacityThresholdLabel: "Kapazitätserhaltungsschwelle",
                        capacityThresholdHint: "Batterieersatz empfohlen unterhalb dieser Schwelle"
                    }
                }
            }
        };

        // 全局语言变量 + 初始化
        let currentLang = localStorage.getItem('selectedLang') || 'zh';

        document.addEventListener('DOMContentLoaded', function() {
            // 绑定语言切换事件
            bindLangSwitchEvent();
            // 初始化语言状态（自动应用登录页选择的语言）
            updateLangBtnStatus();
            updatePageLang(currentLang);
        });

        // 绑定语言切换事件
        function bindLangSwitchEvent() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                // 先移除可能重复的事件，避免冲突
                btn.removeEventListener('click', handleLangClick);
                // 重新绑定事件
                btn.addEventListener('click', handleLangClick);
            });
        }

        // 语言切换点击处理函数
        function handleLangClick() {
            currentLang = this.dataset.lang;
            // 保存到localStorage，实现登录/注册页同步
            localStorage.setItem('selectedLang', currentLang);
            // 更新按钮状态和页面文字
            updateLangBtnStatus();
            updatePageLang(currentLang);
        }

        // 更新语言按钮激活状态
        function updateLangBtnStatus() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === currentLang) {
                    btn.classList.add('active');
                }
            });
        }

        // 核心：更新页面所有文字
        function updatePageLang(lang) {
            const langData = langMap[lang];
            if (!langData) return;

            // 更新页面文字
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const keyPath = el.dataset.i18n.split('.');
                let text = langData;
                
                // 遍历键路径找到对应的值
                for (const key of keyPath) {
                    if (text && text[key]) {
                        text = text[key];
                    } else {
                        // 尝试直接在langData中查找（处理顶级键）
                        if (langData[key]) {
                            text = langData[key];
                        } else {
                            text = null;
                        }
                        break;
                    }
                }
                
                if (text) {
                    el.textContent = text;
                }
            });
        }
    </script>
</body>
</html>
